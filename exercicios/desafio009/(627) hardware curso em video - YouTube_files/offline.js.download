(function(g){var window=this;'use strict';var JaK=function(B){var y=new g.VZ("und",new g.pN("Default","und",!0));y.captionTracks=B.captionTracks;return y},HwY=function(B){return new g.V1(function(y,a){var r=B.length,k=[];
if(r)for(var x=function(l,c){r--;k[l]=c;r==0&&y(k)},J=function(l){a(l)},m,C=0;C<B.length;C++)m=B[C],g.nw$(m,g.oo(x,C),J);
else y(k)})},eP=function(B){this.C=B},DB=function(){eP.apply(this,arguments)},mCV=function(){DB.apply(this,arguments)},otS=function(){DB.apply(this,arguments)},ClY=function(){DB.apply(this,arguments)},gtp=function(){DB.apply(this,arguments)},l8S=function(){DB.apply(this,arguments)},caS=function(){DB.apply(this,arguments)},wGY=function(){eP.apply(this,arguments)},Etp=function(){DB.apply(this,arguments)},zTp=function(){DB.apply(this,arguments)},q9Y=function(){DB.apply(this,arguments)},VEI=function(){DB.apply(this,
arguments)},RTO=function(){DB.apply(this,arguments)},u_S=function(){DB.apply(this,arguments)},Y9u=function(){DB.apply(this,arguments)},Lpp=function(){DB.apply(this,arguments)},NQK=function(){DB.apply(this,arguments)},bwo=function(){DB.apply(this,arguments)},TQ0=function(){DB.apply(this,arguments)},pGY=function(){DB.apply(this,arguments)},tEa=function(){eP.apply(this,arguments)},PlY=function(){DB.apply(this,arguments)},S9Y=function(){DB.apply(this,arguments)},Qb7=function(){DB.apply(this,arguments)},
AaI=function(){DB.apply(this,arguments)},FpO=function(){DB.apply(this,arguments)},GLS=function(){DB.apply(this,arguments)},eTO=function(){DB.apply(this,arguments)},DCO=function(){DB.apply(this,arguments)},Wpa=function(){DB.apply(this,arguments)},KpK=function(){eP.apply(this,arguments)},iwu=function(){eP.apply(this,arguments)},XGK=function(){eP.apply(this,arguments)},f8o=function(){DB.apply(this,arguments)},ME7=function(){DB.apply(this,arguments)},$CK=function(){DB.apply(this,arguments)},Ow1=function(){DB.apply(this,
arguments)},I8p=function(){DB.apply(this,arguments)},ZwY=function(){DB.apply(this,arguments)},ntI=function(){DB.apply(this,arguments)},dCo=function(){DB.apply(this,arguments)},UCS=function(){DB.apply(this,arguments)},jbI=function(){DB.apply(this,arguments)},sb1=function(){DB.apply(this,arguments)},hTu=function(){DB.apply(this,arguments)},vto=function(){DB.apply(this,arguments)},BlY=function(){DB.apply(this,arguments)},yRY=function(){DB.apply(this,arguments)},avC=function(){DB.apply(this,arguments)},
rRK=function(){DB.apply(this,arguments)},kQ7=function(){DB.apply(this,arguments)},xrS=function(){DB.apply(this,arguments)},JRY=function(){DB.apply(this,arguments)},Hx1=function(){DB.apply(this,arguments)},mrp=function(){DB.apply(this,arguments)},on1=function(){DB.apply(this,arguments)},CLV=function(){DB.apply(this,arguments)},gnC=function(){DB.apply(this,arguments)},lv7=function(){DB.apply(this,arguments)},cRY=function(){DB.apply(this,arguments)},wbu=function(){eP.apply(this,arguments)},EnI=function(){DB.apply(this,
arguments)},zaK=function(){DB.apply(this,arguments)},qVC=function(){DB.apply(this,arguments)},VAu=function(){DB.apply(this,arguments)},Rau=function(){DB.apply(this,arguments)},uLI=function(){DB.apply(this,arguments)},YVu=function(){DB.apply(this,arguments)},LVO=function(){DB.apply(this,arguments)},NlO=function(){DB.apply(this,arguments)},bxu=function(){DB.apply(this,arguments)},TlK=function(){DB.apply(this,arguments)},pb0=function(){DB.apply(this,arguments)},tAo=function(){DB.apply(this,arguments)},
PL1=function(){DB.apply(this,arguments)},SVY=function(){DB.apply(this,arguments)},QtY=function(){DB.apply(this,arguments)},AR0=function(){DB.apply(this,arguments)},FVK=function(){DB.apply(this,arguments)},GQY=function(){DB.apply(this,arguments)},eaK=function(){DB.apply(this,arguments)},DrC=function(){DB.apply(this,arguments)},WV1=function(){DB.apply(this,arguments)},KVp=function(){DB.apply(this,arguments)},ix1=function(){DB.apply(this,arguments)},XbO=function(){DB.apply(this,arguments)},fvK=function(){DB.apply(this,
arguments)},MA0=function(){DB.apply(this,arguments)},$r0=function(){DB.apply(this,arguments)},OxY=function(){DB.apply(this,arguments)},IvO=function(){DB.apply(this,arguments)},Zxp=function(){DB.apply(this,arguments)},nnY=function(){DB.apply(this,arguments)},dr0=function(){DB.apply(this,arguments)},Ur7=function(B){B=B.key||B.id;
if(!B)throw Error("Entity key is missing");return B},jtV=function(){if(WU)return WU();
var B={};WU=g.Ij("PersistentEntityStoreDb",{zY:(B.EntityStore={No:1},B.EntityAssociationStore={No:2},B),shared:!1,upgrade:function(y,a){a(1)&&g.pa(g.ub(y,"EntityStore",{keyPath:"key"}),"entityType","entityType");a(2)&&(y=g.ub(y,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.pa(y,"byParentEntityKey","parentEntityKey"),g.pa(y,"byChildEntityKey","childEntityKey"))},
version:3});return WU()},sta=function(B){return g.ep(jtV(),B)},ha7=function(B){return g.ep((0,g.ePV)(),B)},Kd=function(B){this.token=B},iP=function(B,y){y=y===void 0?{}:y;
g.Ku.call(this,g.DGu[B],Object.assign({},{name:"PESEncoderError",type:B},y));this.type=B;this.level="WARNING";Object.setPrototypeOf(this,iP.prototype)},vn0=function(B){return new iP("WRONG_DATA_TYPE",{lU:B})},BaV=function(B){return B instanceof Error?new iP("UNKNOWN_ENCODE_ERROR",{originalMessage:B.message}):new iP("UNKNOWN_ENCODE_ERROR")},yAY=function(B){return B instanceof Error?new iP("UNKNOWN_DECODE_ERROR",{originalMessage:B.message}):new iP("UNKNOWN_DECODE_ERROR")},a2I=function(B,y){B=B instanceof
iP?B:y(B);
g.YU(B);throw B;},rAY=function(){},ko1=function(B,y,a){try{return B.D(y,a)}catch(r){a2I(r,BaV)}},xH0=function(B){B=(new TextEncoder).encode(B).subarray(0,16);
var y=new Uint8Array(16);y.set(B);return y},Xx=function(B){this.C=B},H81=function(B){var y=JA7[B];
if(y)return y;g.Lj(new g.Ku("Entity model not found.",{entityType:B}))},mHY=function(B,y){this.C=B;
this.X=y;this.D={}},C$7=function(B,y){a:{B=ofu(B.X,y.version);
try{var a=B.X(y.data,y.key);break a}catch(r){a2I(r,yAY)}a=void 0}return a},fd=function(B,y,a){return B.C.objectStore("EntityStore").get(y).then(function(r){if(r){if(a&&r.entityType!==a)throw Error("Incorrect entity type");
return C$7(B,r)}})},MX=function(B,y,a){return a?(a=a.map(function(r){return fd(B,r,y)}),g.wj.all(a)):B.C.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(y)).then(function(r){return r.map(function(k){return C$7(B,k)})})},Ou=function(B,y,a){var r=Ur7(y),k=ofu(B.X,1),x=Object.assign({},y);
return B.C.objectStore("EntityStore").get(r).then(function(J){if(J){if(J.entityType!==a)throw Error("Incorrect entity type");x.entityMetadata||(J=C$7(B,J),x.entityMetadata=J.entityMetadata)}}).then(function(){var J={key:r,
entityType:a,data:ko1(k,x,r),version:1};return g.wj.all([g.N3(B.C.objectStore("EntityStore"),J),gfC(B,x,a)])}).then(function(){$T(B,r,a);
return r})},l2p=function(B,y,a){y=y.map(function(r){return Ou(B,r,a)});
return g.wj.all(y)},Iw=function(B,y,a){if(a==null?0:a.vP){var r=new Set;
return cAK(B,y,r).then(function(){for(var x=[],J=g.Y(r),m=J.next();!m.done;m=J.next())x.push(Iw(B,m.value));return g.wj.all(x).then(function(){})})}var k=g.$J(y).entityType;
return g.wj.all([B.C.objectStore("EntityStore").delete(y),wSK(B,y)]).then(function(){$T(B,y,k)})},Ef7=function(B,y){return g.Q4(B.C.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(y)},function(a){return g.wj.all([a.delete(),
wSK(B,a.cursor.primaryKey)]).then(function(){$T(B,a.cursor.primaryKey,y);return g.PL(a)})})},zC7=function(B,y,a,r){var k=ofu(B.X,1);
return fd(B,y,r).then(function(x){if(x){x=g.sa(x,a);var J={key:y,entityType:r,data:ko1(k,x,y),version:1};return g.wj.all([g.N3(B.C.objectStore("EntityStore"),J),gfC(B,x,r)])}}).then(function(){$T(B,y,r);
return y})},$T=function(B,y,a){var r=B.D[a];
r||(r=new Set,B.D[a]=r);r.add(y)},qHY=function(B,y,a){var r=Ur7(y);
a=H81(a);if(!a)return g.wj.resolve([]);a=new a(y);B=B.C.objectStore("EntityAssociationStore");y=[];a=g.Y(a.X());for(var k=a.next();!k.done;k=a.next())y.push(g.N3(B,{parentEntityKey:r,childEntityKey:k.value}));return g.wj.all(y).then(function(x){return x.map(function(J){return J[1]})})},wSK=function(B,y){return B.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(y))},gfC=function(B,y,a){var r=Ur7(y);
return wSK(B,r).then(function(){return qHY(B,y,a)})},cAK=function(B,y,a){if(a.has(y))return g.wj.resolve(void 0);
a.add(y);return Vk7(B,y).then(function(r){return B.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(y)).then(function(){return r})}).then(function(r){var k=g.wj.resolve(void 0);
r=g.Y(r);for(var x=r.next(),J={};!x.done;J={sf:void 0},x=r.next())J.sf=x.value,k=k.then(function(m){return function(){return cAK(B,m.sf,a)}}(J));
return k}).then(function(){})},Vk7=function(B,y){var a=B.C.objectStore("EntityAssociationStore");
return a.index("byParentEntityKey").getAll(IDBKeyRange.only(y)).then(function(r){var k=[];r=g.Y(r);for(var x=r.next();!x.done;x=r.next())x=x.value,k.push(a.index("byChildEntityKey").getAll(x.childEntityKey));return g.wj.all(k)}).then(function(r){var k=[];
r=g.Y(r);for(var x=r.next();!x.done;x=r.next())x=x.value,x.length===1&&k.push(x[0].childEntityKey);return k})},ZB=function(){},RCK=function(){this.C={};
this.C[0]=new ZB;if(!g.lv("aes_pes_encoder_killswitch")){var B=this.C;try{var y=g.iQ();var a=xH0(y);var r=new Xx(new g.xX(a),new g.kX(a))}catch(k){throw B=k instanceof Error?new iP("KEY_CREATION_FAILED",{originalMessage:k.message}):new iP("KEY_CREATION_FAILED"),g.YU(B),B;}B[1]=r}},ofu=function(B,y){y=y===void 0?0:y;
B=B.C[y];if(!B)throw y=new iP("INVALID_ENCODER_VERSION",{lU:y}),g.YU(y),y;return B},nd=function(B,y){g.W.call(this);
this.token=B;this.C=y;this.observers=[];B=new g.vE.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.iQ());B.onmessage=this.X.bind(this);this.channel=B},dw=function(B,y,a){var r,k,x,J;
return g.F(function(m){if(m.X==1)return g.Q(m,sta(B.token),2);if(m.X!=3)return r=m.C,g.Q(m,g.La(r,["EntityStore","EntityAssociationStore"],y,function(C){k=new mHY(C,B.C);return a(k)}),3);
x=m.C;k&&(J=k.D,Object.keys(J).length>0&&(B.channel.postMessage(J),uQO(B,J)));return m.return(x)})},Uu=function(B,y,a){return dw(B,{mode:"readwrite",
Ei:!0},function(r){return Ou(r,y,a)})},YHV=function(B,y){return dw(B,{mode:"readwrite",
Ei:!0},function(a){return l2p(a,y,"offlineOrchestrationActionWrapperEntity")})},Laa=function(B,y){return dw(B,{mode:"readwrite",
Ei:!0},function(a){return Iw(a,y)})},NaY=function(B){return dw(B,{mode:"readwrite",
Ei:!0},function(y){return Ef7(y,"videoPlaybackPositionEntity")})},jP=function(B,y,a){return dw(B,{mode:"readonly",
Ei:!0},function(r){return fd(r,y,a)})},hn=function(B,y,a){return dw(B,{mode:"readonly",
Ei:!0},function(r){return MX(r,y,a)})},uQO=function(B,y){B=g.Y(B.observers);
for(var a=B.next();!a.done;a=B.next())a=a.value,a(y)},b8Y=function(){var B,y,a;
return g.F(function(r){if(r.X==1)return g.TU(r,2),g.Q(r,g.$x(),4);if(r.X!=2){B=r.C;if(!B||!g.XA()||typeof g.vE.BroadcastChannel==="undefined")return r.return();y=new RCK;return r.return(new nd(B,y))}a=g.Sx(r);a instanceof Error&&g.YU(a);return r.return()})},vU=function(){Taa||(Taa=b8Y());
return Taa},pSu=function(B){var y;
B=(y=B.options)==null?void 0:y.persistenceOption;return B==="ENTITY_PERSISTENCE_OPTION_PERSIST"||B==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},tkY=function(B){var y;
return g.F(function(a){return a.X==1?g.Q(a,vU(),2):(y=a.C)?g.Q(a,dw(y,"readwrite",function(r){for(var k={},x=g.Y(B),J=x.next(),m={};!J.done;m={GD:void 0,RW:void 0},J=x.next())m.GD=J.value,m.GD.entityKey&&pSu(m.GD)&&(m.RW=g.xd(m.GD.payload),J=void 0,m.GD.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(J=function(C){return function(){return Ou(r,C.GD.payload[C.RW],C.RW)}}(m)),m.GD.type==="ENTITY_MUTATION_TYPE_DELETE"&&(J=function(C){return function(){return Iw(r,C.GD.entityKey)}}(m)),m.GD.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(J=function(C){return function(){return zC7(r,C.GD.entityKey,C.GD.payload[C.RW],C.RW)}}(m)),J&&(k[m.GD.entityKey]=k[m.GD.entityKey]?k[m.GD.entityKey].then(J):J()));
return g.wj.all(Object.values(k))}),0):a.return()})},P$o=function(B){var y;
return g.F(function(a){if(a.X==1){y=B.mutations;if(!y||y.length<=0)return a.return();if(g.wk){var r={type:"ENTITY_LOADED"};y!==void 0&&(r.payload=y);g.wk.dispatch(r)}return g.Q(a,tkY(y),2)}y.length=0;g.bJ(a)})},SHV=function(B){return B!==void 0},QB1=function(B){var y=g.$N();
y=Object.assign({},y);B=Object.assign({},B);for(var a in y)B[a]?(y[a]!==4&&(y[a]=B[a]),delete B[a]):y[a]!==2&&(y[a]=4);Object.assign(y,B);g.LvK(y);JSON.stringify(y);return y},AAu=function(B){var y,a;
return g.F(function(r){if(r.X==1)return g.Q(r,g.$x(),2);if(r.X!=3)return(y=r.C)?g.Q(r,g.Z6(y),3):r.return();a=r.C;return r.return(g.La(a,["index","media","captions"],{mode:"readwrite",Ei:!0},function(k){var x=IDBKeyRange.bound(B+"|",B+"~");k=[k.objectStore("index").delete(x),k.objectStore("media").delete(x),k.objectStore("captions").delete(x)];return g.wj.all(k).then(function(){})}))})},Fa0=function(){var B,y;
return g.F(function(a){if(a.X==1)return g.Q(a,g.$x(),2);if(a.X!=3){B=a.C;if(!B)throw g.lb("rvdfd");return g.Q(a,g.Z6(B),3)}y=a.C;return a.return(g.La(y,["index","media"],{mode:"readwrite",Ei:!0},function(r){var k={};return g.tG(r.objectStore("index"),{},function(x){var J=x.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),m=g.wj.resolve(void 0);if(J){var C=J[1];J=J[2];k[C]=k[C]||{};var l;k[C][J]=g.t9H((l=x.getValue())==null?void 0:l.fmts)}else m=x.delete().then(function(){});
return g.wj.all([g.PL(x),m]).then(function(c){return g.Y(c).next().value})}).then(function(){for(var x={},J=g.Y(Object.keys(k)),m=J.next();!m.done;m=J.next()){m=m.value;
var C=k[m].v;x[m]=k[m].a&&C?1:2}var l=QB1(x);return g.PfW(r.objectStore("media"),{},function(c){var w=c.cursor.key.match(g.A8x);w&&x[w[1]]||r.objectStore("media").delete(c.cursor.key);return g.RGx(c)}).then(function(){return l})})}))})},Go0=function(B,y){var a,r;
return g.F(function(k){if(k.X==1)return g.Q(k,g.$x(),2);if(k.X!=3){a=k.C;if(!a)throw g.lb("wct");return g.Q(k,g.Z6(a),3)}r=k.C;return g.Q(k,g.La(r,["captions"],{mode:"readwrite",Ei:!0},function(x){var J=[];x=x.objectStore("captions");for(var m=0;m<y.length;m++){var C=g.N3(x,y[m],B+"|"+y[m].metadata.vss_id);J.push(C)}return g.wj.all(J)}),0)})},eCK=function(B){var y,a,r;
return g.F(function(k){if(k.X==1)return y=IDBKeyRange.bound(B+"|",B+"~"),g.Q(k,g.$x(),2);if(k.X!=3){a=k.C;if(!a)throw g.lb("gactfv");return g.Q(k,g.Z6(a),3)}r=k.C;return k.return(r.getAll("captions",y))})},DHS=function(B){return g.F(function(y){g.Iy(B,0);
return y.return(AAu(B))})},Wa7=function(B){return{context:g.MJ(),
videoIds:B}},KaI=function(B){return{context:g.MJ(),
playlistIds:B}},i8K=function(B){return{context:g.MJ(),
offlinePlaylistSyncChecks:B}},XSO=function(){this.C=new Map},Mk0=function(){f2p||(f2p=new XSO);
return f2p},$HS=function(B,y){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:B},metadata:y,statusCode:void 0,csn:void 0,can:void 0}},O80=function(B,y,a){if(!a){var r=r===void 0?!1:r;
a=B.C.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!a||r)a=g.CM(16),B.C.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",a)}B={flowNonce:a,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:y.eventType};y.metadata&&(B.flowMetadata=y.metadata);y.statusCode!==void 0&&(B.flowEventStatus=y.statusCode);y.csn&&(B.csn=y.csn);y.can&&(B.can=y.can);g.BL("flowEvent",B,void 0)},I2C=function(B){var y,a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro,iJ,s7,E7,O7,yO,t,WQ;
return g.F(function(AK){if(AK.X==1)return g.Q(AK,dw(B,{mode:"readonly",Ei:!0},function(r$){return MX(r$,"playbackData").then(function(PC){var N=PC.map(function(XO){return XO.transfer}).filter(function(XO){return!!XO}),a0=PC.map(function(XO){return XO.offlineVideoPolicy}).filter(function(XO){return!!XO}),O3=PC.filter(function(XO){return!!XO.key}).map(function(XO){return g.Oh(g.$J(XO.key).entityId,"downloadStatusEntity")});
N=MX(r$,"transfer",N);a0=MX(r$,"offlineVideoPolicy",a0);O3=MX(r$,"downloadStatusEntity",O3);var xm=N.then(function(XO){XO=XO.reduce(function(n4,hr){(hr==null?0:hr.offlineVideoStreams)&&n4.push.apply(n4,g.Ee(hr.offlineVideoStreams));return n4},[]).filter(function(n4){return!!n4});
return MX(r$,"offlineVideoStreams",XO)});
return g.wj.all([N,a0,xm,O3]).then(function(XO){var n4=g.Y(XO);XO=n4.next().value;var hr=n4.next().value;var j6=n4.next().value;n4=n4.next().value;return[PC,XO,hr,j6,n4]})})}),2);
if(AK.X!=3)return y=AK.C,g.Q(AK,dw(B,{mode:"readonly",Ei:!0},function(r$){return MX(r$,"mainDownloadsListEntity").then(function(PC){var N,a0;return(a0=(N=PC[0])==null?void 0:N.downloads)!=null?a0:[]})}),3);
a=AK.C;r=g.Y(y);k=r.next().value;x=r.next().value;J=r.next().value;m=r.next().value;C=r.next().value;l=k;c=x;w=J;E=m;z=C;q={};L={};b={};S={};P={};A=[];D=g.Y(c);for(M=D.next();!M.done;M=D.next())(U=M.value)&&(q[U.key]=U);n=g.Y(w);for(xW=n.next();!xW.done;xW=n.next())(C4=xW.value)&&(L[C4.key]=C4);HE=g.Y(z);for(g$$=HE.next();!g$$.done;g$$=HE.next())(yr=g$$.value)&&(b[yr.key]=yr);YW=g.Y(E);for(ex=YW.next();!ex.done;ex=YW.next())(BC=ex.value)&&(S[BC.key]=BC);ia=g.Y(a);for(Ro=ia.next();!Ro.done;Ro=ia.next())iJ=
Ro.value,s7=void 0,P[(s7=iJ.videoItem)!=null?s7:""]=!0,iJ.videoItem&&(O7=E7=void 0,yO=(O7=(E7=g.$J(iJ.videoItem))==null?void 0:E7.entityId)!=null?O7:"",A.push({externalVideoId:yO}));t=l.filter(function(r$){if(!r$||!r$.key||!r$.offlineVideoPolicy)return!1;r$=g.$J(r$.key).entityId;r$=g.Oh(r$,"downloadStatusEntity");var PC;return!(r$&&((PC=b[r$])==null?void 0:PC.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
WQ=t.map(function(r$){var PC=q[r$.transfer],N=[];if(PC==null?0:PC.offlineVideoStreams)for(var a0=g.Y(PC.offlineVideoStreams),O3=a0.next();!O3.done;O3=a0.next())(O3=S[O3.value])&&N.push(O3);a0=L[r$.offlineVideoPolicy];O3=P;var xm=r$==null?void 0:r$.playerResponseTimestamp,XO=g.$J(a0.key).entityId;r$=g.Oh(XO,"mainVideoEntity");if(a0.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var n4="OFFLINE_VIDEO_STATE_DISABLED";a0.expirationTimestamp&&Number(a0.expirationTimestamp)<Date.now()/1E3&&(n4="OFFLINE_VIDEO_STATE_EXPIRED")}else if(a0.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")n4="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(PC==null?void 0:PC.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":n4="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":n4="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":n4="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":n4="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":n4="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":n4="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:n4="OFFLINE_VIDEO_STATE_UNKNOWN"}if(n4==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(PC==null?void 0:PC.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":n4="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":n4="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":n4=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}XO={id:XO,videoState:n4};if(PC==null?0:PC.cotn)XO.cotn=PC.cotn;if(PC==null?0:PC.maximumDownloadQuality)XO.selectedVideoQuality=PC==null?void 0:PC.maximumDownloadQuality;if(PC==null?0:PC.lastProgressTimeMs)XO.lastProgressTimeMs=PC.lastProgressTimeMs;xm&&(XO.playerResponseSavedTimeMs=String(Number(xm)*1E3));PC=String;xm=0;N=g.Y(N);for(n4=N.next();!n4.done;n4=N.next())if(n4=n4.value,n4.streamsProgress){n4=g.Y(n4.streamsProgress);for(var hr=n4.next();!hr.done;hr=n4.next()){var j6=
void 0;xm+=Number((j6=hr.value.numBytesDownloaded)!=null?j6:0)}}XO.downloadedBytes=PC(xm);XO.selectedOfflineMode=O3[r$]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";a0.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(XO.offlinePlaybackDisabledReason=a0.offlinePlaybackDisabledReason);return XO});
return AK.return({offlineVideos:WQ,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:A}}})})},Z8Y=function(){this.locks=navigator.locks},nfa=function(){try{var B=g.ao("ytglobal.locks_");
if(B)return B;var y;if(y=navigator){var a=navigator;y="locks"in a&&!!a.locks}if(y)return g.vE.localStorage&&g.vE.localStorage.getItem("noop"),B=new Z8Y,g.yp("ytglobal.locks_",B),B}catch(r){}},BW=function(){},dHp=function(){},UH0=function(B){if(B.includes(":"))throw Error("Invalid user cache name: "+B);
return B+":"+g.iQ("CacheStorage get")},jBK=function(){return g.F(function(B){if(yb!==void 0)return B.return(yb);
yb=new Promise(function(y){var a;return g.F(function(r){switch(r.X){case 1:return g.TU(r,2),g.Q(r,an.open("test-only"),4);case 4:return g.Q(r,an.delete("test-only"),5);case 5:g.PE(r,3);break;case 2:if(a=g.Sx(r),a instanceof Error&&a.name==="SecurityError")return y(!1),r.return();case 3:y("caches"in window),g.bJ(r)}})});
return B.return(yb)})},hCa=function(){return g.F(function(B){if(B.X==1)return g.Q(B,jBK(),2);
if(!B.C)return B.return(void 0);sBa||(sBa=new dHp);return B.return(sBa)})},rg=function(B,y,a){g.Lj(new g.Ku("Woffle: "+B,a?{cotn:a}:""));
y instanceof Error&&g.Lj(y)},vfS=function(B){var y;
return g.F(function(a){if(a.X==1)return g.Q(a,I2C(B),2);y=a.C;g.BL("offlineStateSnapshot",y);g.bJ(a)})},kl=function(B){g.W.call(this);
var y=this;this.api=B;this.H6={NRm:function(){return y.C},
gUQ:function(){return y.X}};
typeof g.vE.BroadcastChannel!=="undefined"&&(this.C=new g.vE.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.iQ()),this.C.onmessage=this.D.bind(this),this.X=new g.vE.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.iQ()),this.X.onmessage=this.J.bind(this))},xl=function(B,y){B.api.Kh("onOfflineOperationFailure",y);
var a;(a=B.C)==null||a.postMessage(y)},BDp=function(B,y,a,r){var k=this;
this.K=B;this.U=y;this.visibility=a;this.Z=r;this.j=this.N=this.T=this.D=this.C=!1;this.J=new g.Mv(function(){k.Ro()});
this.H6={ST:function(){return k.X},
Ro:function(){k.Ro()},
Oah:function(){return k.J}};
this.visibility.subscribe("visibilitystatechange",function(){k.pV()})},yX0=function(B){if(!B.D&&!B.C){var y=nfa();
if(y){B.D=!0;var a=g.iQ("OfflineLockManager");y.request("woffle_orchestration_leader:"+a,{},function(){var r,k,x,J;return g.F(function(m){switch(m.X){case 1:return g.TU(m,2),B.X=new g.JX,B.C=!0,B.D=!1,g.Q(m,B.K(),4);case 4:return g.Q(m,B.X.promise,5);case 5:g.PE(m,0);break;case 2:r=g.Sx(m),((x=(k=B).Z)==null?0:x.call(k,"wo_relinquish_leadership_on_lock_request_error"))||B.Ro(),r instanceof Error&&(J=r,J.args=[{name:"WoLockManagerError",zA:r.name}],g.YU(J)),g.bJ(m)}})})}}},aHK=function(B){B.C&&(B.j=
!0,JF(B))},rXo=function(B,y){B.C&&(B.T=y,JF(B))},kRu=function(B,y){B.C&&(B.N=y,JF(B))},JF=function(B){B.N&&B.T&&B.j&&B.visibility.isBackground()?g.$h(B.J,6E4):B.J.stop()},HW=function(B){var y;
B.offlineDeleteReason=(y=B.offlineDeleteReason)!=null?y:"OFFLINE_DELETE_REASON_UNKNOWN";var a;B.offlineModeType=(a=B.offlineModeType)!=null?a:"OFFLINE_NOW";g.BL("offlineDeleteEvent",B)},mc=function(B,y){var a=y.videoId;
var r=y.Jm;y=y.offlineModeType;B.encryptedVideoId=a;B.cotn=r==null?void 0:r.cotn;B.offlineabilityFormatType=r==null?void 0:r.maximumDownloadQuality;var k;B.isRefresh=(k=r==null?void 0:r.isRefresh)!=null?k:!1;var x;B.softErrorCount=(x=r==null?void 0:r.transferRetryCount)!=null?x:0;B.offlineModeType=y!=null?y:"OFFLINE_NOW";(B.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&B.statusType==="UNKNOWN_STATUS_TYPE"||!B.transferStatusType&&!B.statusType)&&g.Lj(Error("Woffle unknown transfer status"));
g.BL("offlineTransferStatusChanged",B)},x1K=function(B){mc({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},B)},JXu=function(B,y,a,r){r={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!r};y&&a&&(y=Math.floor(y/1024).toFixed(),a=Math.floor(a/1024).toFixed(),r.alreadyDownloadedKbytes=y,r.totalFetchedKbytes=y,r.totalContentKbytes=a);mc(r,B)},Hh7=function(B){mc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},B)},m1K=function(B){mc({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},B)},okI=function(B){switch(B){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
on=function(B){var y,a,r;
return((r=(y=B.actionMetadata)==null?void 0:(a=y.retryScheduleIntervalsInSeconds)==null?void 0:a.length)!=null?r:0)>0},CA=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!B.entityKey},gg=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!B.entityKey},lO=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!B.entityKey},CXO=function(B){return B.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!B.entityKey},
cW=function(B,y,a,r,k){k=k===void 0?!1:k;
var x,J,m,C,l,c;return g.F(function(w){if(w.X==1)return x=g.Oh(B,y),J=g.Oh(B,"downloadStatusEntity"),g.Q(w,dw(a,{mode:"readonly",Ei:!0},function(E){return g.wj.all([fd(E,x,y),fd(E,J,"downloadStatusEntity")])}),2);
m=w.C;C=m.length?m[0]:void 0;if(!C)return w.dQ(0);l=gk0;if(c=m.length>1?m[1]:void 0){if(c.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!k)return w.return();c.downloadState=r}else c={key:J,downloadState:r};g.tk(C,l,c);return g.Q(w,dw(a,{mode:"readwrite",Ei:!0},function(E){return g.wj.all([Ou(E,C,y),Ou(E,c,"downloadStatusEntity")])}),0)})},wg=function(B,y){return B.actionType===y.actionType&&B.entityKey===y.entityKey},EQ=function(B,y){if(B&&B.transferState!=="TRANSFER_STATE_COMPLETE"&&B.transferState!==
"TRANSFER_STATE_FAILED"){var a=g.$J(B.key).entityId;
mc({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:a,Jm:B,offlineModeType:y})}},zb=function(B){if(!B||!B.thumbnails)return[];
var y=[];B=g.Y(B.thumbnails);for(var a=B.next();!a.done;a=B.next())a=a.value,a.url&&y.push(a.url);return y},lHO=function(B,y,a){a=a===void 0?[]:a;
var r,k,x,J,m,C,l,c,w,E,z,q,L;return g.F(function(b){if(b.X==1)return a.length?g.Q(b,hn(B,y),2):b.return([]);r=b.C;k=new Set;x=g.Y(r);for(J=x.next();!J.done;J=x.next())if(m=J.value,C=m.id||m.key)l=g.$J(C).entityId,k.add(l);c=[];w=g.Y(a);for(E=w.next();!E.done;E=w.next())z=E.value,q=z.offlineVideoData,L=void 0,((L=q)==null?0:L.videoId)&&!k.has(q.videoId)&&c.push(z);return b.return(c)})},cXo=function(B,y,a){return new g.kC(B,{cotn:y,
raw_player_response:a,download_media:!0,start:Infinity,disable_watch_next:!0})},wkS=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},qd=function(B,y,a,r,k,x,J,m,C,l,c){this.entityType=B;
this.actionId=y;this.action=a;this.parentActionId=r;this.rootActionId=k===void 0?y:k;this.childActionIds=x;this.prereqActionId=J;this.postreqActionIds=m;this.hasChildActionFailed=l;this.retryScheduleIndex=0;this.C=c||Date.now();this.retryScheduleIndex=C||0},Vb=function(B){if(!B.key)throw Error("Entity key is required.");
if(!B.actionProto)throw Error("OfflineOrchestrationAction is required.");var y=g.$J(B.key),a=g.$J(B.actionProto.entityKey);return new qd(a.entityType,y.entityId,B.actionProto,B.parentActionId,B.rootActionId,B.childActionIds,B.prereqActionId,B.postreqActionIds,B.retryScheduleIndex,B.hasChildActionFailed,Number(B.enqueueTimeSec)*1E3)},Rn=function(B){return{key:g.Oh(B.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:B.action,parentActionId:B.parentActionId,rootActionId:B.rootActionId,childActionIds:B.childActionIds,prereqActionId:B.prereqActionId,postreqActionIds:B.postreqActionIds,retryScheduleIndex:B.retryScheduleIndex,hasChildActionFailed:B.hasChildActionFailed,enqueueTimeSec:(B.C/1E3).toFixed()}},EkS=function(){var B;
return g.F(function(y){return y.X==1?g.Q(y,hCa(),2):(B=y.C)?y.return(B.delete("yt-player-local-img")):y.return(!0)})},uO=function(B){var y,a;
return g.F(function(r){if(r.X==1)return g.Q(r,hCa(),2);if(r.X!=3){y=r.C;if(!y)throw Error("Cache API not supported");return B.length?g.Q(r,y.open("yt-player-local-img"),3):r.return()}a=r.C;return g.Q(r,Promise.all(B.map(function(k){return a.delete(k)})),0)})},Yl=function(B){var y,a;
return g.F(function(r){if(r.X==1)return g.Q(r,hCa(),2);if(r.X!=3){y=r.C;if(!y)throw Error("Cache API not supported");return B.length?g.Q(r,y.open("yt-player-local-img"),3):r.return()}a=r.C;return g.Q(r,a.addAll(B),0)})},LA=function(B,y,a,r,k){var x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro,iJ,s7;
return g.F(function(E7){switch(E7.X){case 1:return x=g.Oh(B,"mainVideoEntity"),J=g.Oh(B,"ytMainChannelEntity"),m=g.Oh(B,"transfer"),C=g.Oh(B,"videoDownloadContextEntity"),g.Q(E7,dw(y,{mode:"readonly",Ei:!0},function(O7){return g.wj.all([fd(O7,x,"mainVideoEntity"),fd(O7,J,"ytMainChannelEntity"),fd(O7,m,"transfer"),fd(O7,C,"videoDownloadContextEntity"),MX(O7,"ytMainChannelEntity"),MX(O7,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:l=E7.C;c=g.Y(l);w=c.next().value;E=c.next().value;z=c.next().value;q=c.next().value;L=c.next().value;b=c.next().value;S=w;P=E;A=z;D=q;M=L;U=b;if(!S&&!P){E7.dQ(3);break}n=S?zb(S.thumbnail):[];if(!P){xW=[];E7.dQ(4);break}return g.Q(E7,zIV(P,M),5);case 5:xW=E7.C;case 4:return C4=xW,g.Q(E7,uO(n.concat(C4)),3);case 3:HE=[];g$$=g.Oh(B,"downloadStatusEntity");yr=g.Y(U);for(YW=yr.next();!YW.done;YW=yr.next())ex=YW.value,BC=g.$J(ex.key).entityId,ia=Vb(ex),Ro=g.$J(ia.action.entityKey).entityId,BC!==
B&&Ro!==B||wg(a,ex.actionProto)||HE.push(ex.key);return g.Q(E7,dw(y,{mode:"readwrite",Ei:!0},function(O7){var yO=HE.map(function(t){return Iw(O7,t)});
yO.push(Iw(O7,x,{vP:!0}));yO.push(Iw(O7,g$$,{vP:!0}));return g.wj.all(yO)}),7);
case 7:s7=(iJ=D)==null?void 0:iJ.offlineModeType,k&&(HW(k),k.offlineModeType&&(s7=k.offlineModeType)),EQ(A,s7),xl(r,{entityKey:x,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.bJ(E7)}})},RI0=function(B,y,a,r){var k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro,iJ,s7,E7,O7,yO,t,WQ,AK,r$,PC,N,a0,O3,xm,XO,n4,hr,j6,K_,T;
return g.F(function(u){switch(u.X){case 1:return k=g.Oh(B,"mainPlaylistEntity"),x=g.Oh(B,"ytMainChannelEntity"),g.Q(u,dw(y,{mode:"readonly",Ei:!0},function(p){return g.wj.all([fd(p,k,"mainPlaylistEntity"),fd(p,x,"ytMainChannelEntity"),MX(p,"mainPlaylistEntity"),MX(p,"mainDownloadsListEntity"),MX(p,"ytMainChannelEntity"),MX(p,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:J=u.C;m=g.Y(J);C=m.next().value;l=m.next().value;c=m.next().value;w=m.next().value;E=m.next().value;z=m.next().value;q=C;L=l;b=c;S=w;P=E;A=z;if(!q&&!L){u.dQ(3);break}D=q?qjO(q):[];if(!L){M=[];u.dQ(4);break}return g.Q(u,zIV(L,P),5);case 5:M=u.C;case 4:return U=M,g.Q(u,uO(D.concat(U)),3);case 3:n=[];xW=new Map;if(!q){u.dQ(7);break}return g.Q(u,V1K(q,b,S),8);case 8:n=u.C;C4=g.Y(n);for(HE=C4.next();!HE.done;HE=C4.next())g$$=HE.value,xW.set(g$$,{videoId:g$$,playlistId:B,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.Q(u,dw(y,{mode:"readonly",Ei:!0},function(p){return g.wj.all([MX(p,"transfer"),MX(p,"videoDownloadContextEntity")])}),9);
case 9:yr=u.C;YW=g.Y(yr);ex=YW.next().value;BC=YW.next().value;ia=ex;Ro=BC;iJ=g.Y(ia);for(s7=iJ.next();!s7.done;s7=iJ.next())E7=s7.value,O7=g.$J(E7.key).entityId,(yO=xW.get(O7))&&E7&&(yO.cotn=E7.cotn);t=g.Y(Ro);for(WQ=t.next();!WQ.done;WQ=t.next())AK=WQ.value,r$=g.$J(AK.key).entityId,(PC=xW.get(r$))&&AK&&(PC.offlineModeType=AK.offlineModeType);case 7:N=[];a0=g.Y(A);for(O3=a0.next();!O3.done;O3=a0.next())xm=O3.value,XO=g.$J(xm.key).entityId,n4=Vb(xm),XO!==B&&n4.rootActionId!==B||wg(a,xm.actionProto)||
N.push(xm.key);hr=g.Oh(B,"mainPlaylistEntity");return g.Q(u,dw(y,{mode:"readwrite",Ei:!0},function(p){var G=N.map(function(X){return Iw(p,X)});
G.push(Iw(p,hr,{vP:!0}));return g.wj.all(G)}),10);
case 10:if(!q){u.dQ(0);break}n.reverse();if(!n){u.dQ(0);break}j6=g.Y(n);K_=j6.next();case 13:if(K_.done){u.dQ(0);break}T=K_.value;return g.Q(u,LA(T,y,a,r,xW.get(T)),14);case 14:K_=j6.next(),u.dQ(13)}})},YjC=function(B,y,a,r){var k,x,J,m,C,l,c,w,E;
return g.F(function(z){if(z.X==1)return k=g.Oh("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),x=new Map,g.Q(z,dw(B,{mode:"readwrite",Ei:!0},function(q){var L=MX(q,"transfer"),b=MX(q,"offlineOrchestrationActionWrapperEntity"),S=MX(q,"videoDownloadContextEntity"),P=fd(q,k,"mainDownloadsListEntity");return g.wj.all([L,b,S,P]).then(function(A){A=g.Y(A);var D=A.next().value;var M=A.next().value;var U=A.next().value;var n=A.next().value;A=uKK.map(function(C4){return Ef7(q,C4)});
M=g.Y(M);for(var xW=M.next();!xW.done;xW=M.next())xW=xW.value,wg(y,xW.actionProto)||A.push(Iw(q,xW.key,{vP:!0}));n&&(n.downloads=[],A.push(Ou(q,n,"mainDownloadsListEntity")));if(U)for(U=g.Y(U),n=U.next();!n.done;n=U.next())n=n.value,M=g.$J(n.key).entityId,M=g.Oh(M,"transfer"),x.set(M,n.offlineModeType);return g.wj.all(A).then(function(){return D})})}),2);
J=z.C;m=g.Y(J);for(C=m.next();!C.done;C=m.next())l=C.value,EQ(l,x.get(l.key)),c=g.$J(l.key).entityId,w={videoId:c,offlineDeleteReason:r,cotn:l.cotn,offlineModeType:x.get(l.key)},HW(w),E=g.Oh(c,"mainVideoEntity"),xl(a,{entityKey:E,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.Q(z,EkS(),0)})},qjO=function(B,y){var a=[];
if(B.thumbnailStyleData){B=g.Y(B.thumbnailStyleData);for(var r=B.next();!r.done;r=B.next()){var k=void 0,x=void 0,J=void 0;a=a.concat(zb((k=r.value)==null?void 0:(x=k.value)==null?void 0:(J=x.collageThumbnail)==null?void 0:J.coverThumbnail))}}y=zb(y);return a.concat(y)},V1K=function(B,y,a){var r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4;
return g.F(function(HE){r=[];k=new Set;if(a.length)for(x=g.Y(a),J=x.next();!J.done;J=x.next())if(m=J.value,C=void 0,(C=m.downloads)==null?0:C.length)for(l=g.Y(m.downloads),c=l.next();!c.done;c=l.next())w=c.value,w.videoItem&&(E=g.$J(w.videoItem).entityId,k.add(E));if(B.videos){z=g.Y(B.videos);for(q=z.next();!q.done;q=z.next())L=q.value,b=JSON.parse(g.$J(L).entityId),b.videoId&&!k.has(b.videoId)&&r.push(b.videoId);S=g.Y(y);for(P=S.next();!P.done;P=S.next())if(A=P.value,A.key!==B.key&&(D=A.videos))for(M=
g.Y(D),U=M.next();!U.done;U=M.next())n=U.value,xW=JSON.parse(g.$J(n).entityId),xW.videoId&&(C4=r.indexOf(xW.videoId),C4!==-1&&r.splice(C4,1))}return HE.return(r)})},zIV=function(B,y){var a,r,k,x,J,m,C,l;
return g.F(function(c){a=zb(B.avatar);r=g.Y(y);for(k=r.next();!k.done;k=r.next())if(x=k.value,x.id!==B.id)for(J=g.Y(zb(x.avatar)),m=J.next();!m.done;m=J.next())C=m.value,l=a.indexOf(C),l!==-1&&a.splice(l,1);return c.return(a)})},LM7=function(B){var y;
return g.F(function(a){y=g.f(B.frameworkUpdates,Nd);return B.frameworkUpdates&&y?g.Q(a,P$o(y),0):a.return()})},bhY=function(B){var y;
if((y=B.onResponseReceivedActions)!=null&&y.length){var a;B=(a=g.f(g.f(B.onResponseReceivedActions[0],NDu),g.F$a))==null?void 0:a.actions;if(B!=null&&B.length)return B}},TDY=function(B){var y,a,r;
return g.F(function(k){if(k.X==1)return B?g.Q(k,jP(B,g.iF,"mainDownloadsListEntity"),2):k.return([]);y=k.C;return((a=y)==null?0:(r=a.downloads)==null?0:r.length)?k.return(y.downloads.map(function(x){var J;return(J=x.videoItem)!=null?J:""})):k.return([])})},t1K=function(B,y){var a;
return g.F(function(r){return r.X==1?g.Q(r,pkO(B,y),2):(a=r.C)?g.Q(r,dw(B,{mode:"readwrite",Ei:!0},function(k){var x=[Ou(k,a.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];a.mainDownloadsListEntity&&x.push(Ou(k,a.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.wj.all(x)}),0):r.dQ(0)})},pkO=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A;
return g.F(function(D){if(D.X==1)return a=g.Oh("main_downloads_library_id","mainDownloadsLibraryEntity"),r=g.Oh("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.Q(D,dw(B,{mode:"readonly",Ei:!0},function(M){return g.wj.all([fd(M,a,"mainDownloadsLibraryEntity"),fd(M,r,"mainDownloadsListEntity")])}),2);
k=D.C;x=g.Y(k);J=x.next().value;m=x.next().value;C=J;l=m;C||(C={id:a});c=g.Y(y);for(w=c.next();!w.done;w=c.next())if(E=w.value,E===g.iF){if(C.smartDownloadsList)return D.return();C.smartDownloadsList=E}else if(z=g.$J(E).entityType,q={},z==="mainPlaylistEntity"?q.playlistItem=E:z==="mainVideoEntity"&&(q.videoItem=E),!g.lC(q)){L=void 0;if((L=l)==null?0:L.downloads){b=!1;S=g.Y(l.downloads);for(P=S.next();!P.done;P=S.next())if(A=P.value,A.playlistItem===E||A.videoItem===E){b=!0;break}b||l.downloads.push(q)}else l=
{id:r,downloads:[q]};C.downloadsList=r}return D.return({mainDownloadsLibraryEntity:C,mainDownloadsListEntity:l})})},PX7=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b;
return g.F(function(S){if(S.X==1)return a=g.Oh("main_downloads_library_id","mainDownloadsLibraryEntity"),r=g.Oh("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.Q(S,dw(B,{mode:"readonly",Ei:!0},function(P){return g.wj.all([fd(P,a,"mainDownloadsLibraryEntity"),fd(P,r,"mainDownloadsListEntity"),fd(P,g.iF,"mainDownloadsListEntity")])}),2);
k=S.C;x=g.Y(k);J=x.next().value;m=x.next().value;C=x.next().value;l=J;c=m;w=C;if(!l)return S.dQ(0);if(y===g.iF&&((E=w)==null?0:E.downloads))w.downloads=[];else if((z=c)==null?0:z.downloads)for(q=g.$J(y).entityType,L=0;L<c.downloads.length;L++)if(b=c.downloads[L],q==="mainVideoEntity"&&b.videoItem===y){c.downloads.splice(L,1);break}else if(q==="mainPlaylistEntity"&&b.playlistItem===y){c.downloads.splice(L,1);break}return g.Q(S,dw(B,{mode:"readwrite",Ei:!0},function(P){var A=[Ou(P,l,"mainDownloadsLibraryEntity")];
c&&A.push(Ou(P,c,"mainDownloadsListEntity"));w&&A.push(Ou(P,w,"mainDownloadsListEntity"));return g.wj.all(A)}),0)})},bO=function(B,y){var a,r,k,x,J,m,C,l,c,w,E;
return g.F(function(z){if(z.X==1)return a=g.Oh(y,"transfer"),r=g.Oh(y,"videoDownloadContextEntity"),g.Q(z,dw(B,{mode:"readonly",Ei:!0},function(q){return g.wj.all([fd(q,a,"transfer"),fd(q,r,"videoDownloadContextEntity")])}),2);
k=z.C;x=g.Y(k);J=x.next().value;m=x.next().value;C=J;l=m;E={videoId:y,cotn:(c=C)==null?void 0:c.cotn,offlineModeType:(w=l)==null?void 0:w.offlineModeType};return z.return(E)})},Tb=function(B,y,a,r,k){var x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW;
return g.F(function(C4){switch(C4.X){case 1:return x=g.Oh(B,"musicTrack"),J=g.Oh(B,"transfer"),g.Q(C4,dw(y,{mode:"readonly",Ei:!0},function(HE){return g.wj.all([fd(HE,x,"musicTrack"),fd(HE,J,"transfer"),MX(HE,"musicTrack"),MX(HE,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:m=C4.C;C=g.Y(m);l=C.next().value;c=C.next().value;w=C.next().value;E=C.next().value;z=l;q=c;L=w;b=E;if(!z){C4.dQ(3);break}return g.Q(C4,SjK(z,L),4);case 4:return S=C4.C,g.Q(C4,uO(S),3);case 3:P=[];A=g.Y(b);for(D=A.next();!D.done;D=A.next())M=D.value,U=g.$J(M.key).entityId,n=Vb(M),xW=g.$J(n.action.entityKey).entityId,U!==B&&xW!==B||wg(a,M.actionProto)||P.push(M.key);return g.Q(C4,dw(y,{mode:"readwrite",Ei:!0},function(HE){var g$$=P.map(function(yr){return Iw(HE,yr)});
g$$.push(Iw(HE,x,{vP:!0}));return g.wj.all(g$$)}),6);
case 6:EQ(q),k&&HW(k),xl(r,{entityKey:x,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.bJ(C4)}})},pA=function(B,y,a,r,k){var x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro,iJ,s7,E7,O7,yO,t,WQ;
return g.F(function(AK){switch(AK.X){case 1:return x=g.Oh(B,y),J=g.Oh("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Q(AK,dw(a,{mode:"readonly",Ei:!0},function(r$){return g.wj.all([fd(r$,x,y),fd(r$,J,"musicDownloadsLibraryEntity"),MX(r$,y),MX(r$,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:m=AK.C;C=g.Y(m);l=C.next().value;c=C.next().value;w=C.next().value;E=C.next().value;z=l;q=c;L=w;b=E;if(!z){AK.dQ(3);break}return g.Q(AK,SjK(z,L),4);case 4:return S=AK.C,g.Q(AK,uO(S),3);case 3:P=[];A=new Map;if(!z){AK.dQ(6);break}return g.Q(AK,Q9Y(z,L,q),7);case 7:P=AK.C;D=g.Y(P);for(M=D.next();!M.done;M=D.next())U=M.value,n=g.$J(U).entityId,A.set(n,{videoId:n,playlistId:B,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.Q(AK,hn(a,"transfer"),8);case 8:for(xW=AK.C,C4=
g.Y(xW),HE=C4.next();!HE.done;HE=C4.next())g$$=HE.value,yr=g.$J(g$$.key).entityId,(YW=A.get(yr))&&g$$&&(YW.cotn=g$$.cotn);case 6:ex=[];BC=g.Y(b);for(ia=BC.next();!ia.done;ia=BC.next())Ro=ia.value,iJ=g.$J(Ro.key).entityId,s7=Vb(Ro),iJ!==B&&s7.rootActionId!==B||wg(r,Ro.actionProto)||ex.push(Ro.key);E7=g.Oh(B,y);return g.Q(AK,dw(a,{mode:"readwrite",Ei:!0},function(r$){var PC=ex.map(function(N){return Iw(r$,N)});
PC.push(Iw(r$,E7,{vP:!0}));return g.wj.all(PC)}),9);
case 9:if(!z){AK.dQ(0);break}P.reverse();if(!P.length){AK.dQ(0);break}O7=g.Y(P);yO=O7.next();case 12:if(yO.done){AK.dQ(0);break}t=yO.value;WQ=g.$J(t).entityId;if(!WQ){AK.dQ(13);break}return g.Q(AK,Tb(WQ,a,r,k,A.get(WQ)),13);case 13:yO=O7.next(),AK.dQ(12)}})},tF=function(B,y,a){var r,k,x,J,m,C,l;
return g.F(function(c){if(c.X==1)return g.Q(c,dw(B,{mode:"readwrite",Ei:!0},function(w){var E=MX(w,"transfer"),z=MX(w,"offlineOrchestrationActionWrapperEntity");return g.wj.all([E,z]).then(function(q){q=g.Y(q);var L=q.next().value;var b=q.next().value;q=AXa.map(function(D){return Ef7(w,D)});
b=g.Y(b);for(var S=b.next();!S.done;S=b.next()){S=S.value;var P=g.$J(S.actionProto.entityKey).entityType==="musicTrack",A=S.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";wg(y,S.actionProto)||P&&(!P||A)||q.push(Iw(w,S.key,{vP:!0}))}return g.wj.all(q).then(function(){return L})})}),2);
r=c.C;k=g.Y(r);for(x=k.next();!x.done;x=k.next())J=x.value,EQ(J),m=g.$J(J.key).entityId,C={videoId:m,offlineDeleteReason:void 0,cotn:J.cotn},HW(C),l=g.Oh(m,"musicTrack"),xl(a,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.Q(c,EkS(),0)})},FM7=function(B){for(var y,a=g.Y(B.additionalMetadatas),r=a.next();!r.done;r=a.next())r=r.value,r.offlineMusicVideoData&&(y=r.offlineMusicVideoData);
var k,x,J,m,C;return{id:g.Oh(B.videoId,"musicTrack"),videoId:B.videoId,title:B.title,thumbnailDetails:B.thumbnail,lengthMs:String(Number(B.lengthSeconds)*1E3),albumTitle:(k=y)==null?void 0:k.releaseTitle,musicVideoType:(x=y)==null?void 0:x.musicVideoType,contentRating:{explicitType:(J=y)==null?void 0:J.explicitType},artistNames:((m=y)==null?void 0:m.byline)||((C=y)==null?void 0:C.channelName),downloadMetadata:g.Oh(B.videoId,"musicTrackDownloadMetadataEntity")}},Q9Y=function(B,y,a){var r,k,x,J,m,C,
l,c,w,E,z,q,L,b,S,P,A,D;
return g.F(function(M){r=[];k=new Set;if((x=a)==null?0:(J=x.downloadedTracks)==null?0:J.length)for(m=g.Y(a.downloadedTracks),C=m.next();!C.done;C=m.next())l=C.value,k.add(l);if(B.tracks){c=g.Y(B.tracks);for(w=c.next();!w.done;w=c.next())E=w.value,k.has(E)||r.push(E);z=g.Y(y);for(q=z.next();!q.done;q=z.next())if(L=q.value,L.id!==B.id&&(b=L.tracks))for(S=g.Y(b),P=S.next();!P.done;P=S.next())A=P.value,D=r.indexOf(A),D!==-1&&r.splice(D,1)}return M.return(r)})},SjK=function(B,y){var a,r,k,x,J,m,C,l;
return g.F(function(c){a=zb(B.thumbnailDetails);r=g.Y(y);for(k=r.next();!k.done;k=r.next())if(x=k.value,x.id!==B.id)for(J=g.Y(zb(x.thumbnailDetails)),m=J.next();!m.done;m=J.next())C=m.value,l=a.indexOf(C),l!==-1&&a.splice(l,1);return c.return(a)})},GRo=function(B,y){var a,r,k,x,J,m,C,l,c;
return g.F(function(w){if(w.X==1)return a=g.Oh("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Q(w,jP(B,a,"musicDownloadsLibraryEntity"),2);(r=w.C)||(r={id:a});k=g.$J(y).entityType;k==="musicTrack"?(x=r.downloadedTracks)!=null&&x.includes(y)||(r.downloadedTracks=((J=r.downloadedTracks)!=null?J:[]).concat(y)):k==="musicPlaylist"?(m=r.downloadedPlaylists)!=null&&m.includes(y)||(r.downloadedPlaylists=((C=r.downloadedPlaylists)!=null?C:[]).concat(y)):k!=="musicAlbumRelease"||(l=r.downloadedAlbumReleases)!=
null&&l.includes(y)||(r.downloadedAlbumReleases=((c=r.downloadedAlbumReleases)!=null?c:[]).concat(y));return g.Q(w,Uu(B,r,"musicDownloadsLibraryEntity"),0)})},eIS=function(B,y){var a,r,k,x,J,m,C;
return g.F(function(l){if(l.X==1)return a=g.Oh("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Q(l,jP(B,a,"musicDownloadsLibraryEntity"),2);r=l.C;if(!r)return l.dQ(0);k=g.$J(y).entityType;k==="musicTrack"?x=r.downloadedTracks:k==="musicPlaylist"&&(x=r.downloadedPlaylists);if((J=x)==null?0:J.length)for(m=0;m<x.length;m++)if(C=x[m],C===y){x.splice(m,1);break}return g.Q(l,Uu(B,r,"musicDownloadsLibraryEntity"),0)})},D1S=function(B){var y=B.videos;
B=[];var a=[];if(y){y=g.Y(y);for(var r=y.next();!r.done;r=y.next()){var k=r.value.offlineVideoData.videoId;r=g.Oh(k,"musicTrack");k=g.Oh(k,"musicTrackDownloadMetadataEntity");B.push(r);a.push(k)}}return{z5:B,Ey:a}},PW=function(B,y,a){y={track:FM7(y)};
a&&(y.playlistId=a);if(B=g.f(B.actionMetadata,WMC))y.maximumDownloadQuality=B.maximumDownloadQuality;return{musicTrackEntityActionMetadata:y}},iho=function(B){var y,a,r,k,x,J,m,C;
return g.F(function(l){switch(l.X){case 1:return y=g.Xy(),a=Wa7(B),r=g.Ii(KM7),g.TU(l,2),x={YU:!0},g.Q(l,g.Ps(y,a,r,void 0,x),4);case 4:k=l.C;g.PE(l,3);break;case 2:J=g.Sx(l);if(J instanceof g.Ws)throw m="GetOffline network manager error: "+J.message,rg(m,J),Error(m);rg("GetOffline fetch request error",J);throw Error("GetOffline fetch request error");case 3:C=ST(k);if(!k)throw rg("Network request failed"),Error("Network request failed");if(C!==void 0)Qb(C);else if(!k.videos||!k.videos.length)throw rg("No data"),
Error("No data");return l.return(k.videos.map(function(c){return c.offlineVideoData}))}})},XkY=function(B){var y,a,r,k,x,J,m,C;
return g.F(function(l){switch(l.X){case 1:return y=g.Xy(),a=KaI(B),r=g.Ii(KM7),g.TU(l,2),x={YU:!0},g.Q(l,g.Ps(y,a,r,void 0,x),4);case 4:k=l.C;g.PE(l,3);break;case 2:J=g.Sx(l);if(J instanceof g.Ws)throw m="GetOffline network manager error for playlist: "+J.message,rg(m,J),Error(m);rg("GetOffline fetch request error for playlist",J);throw Error("GetOffline fetch request error for playlist");case 3:C=ST(k);if(!k)throw rg("Network request failed for playlist"),Error("Network request failed for playlist");
if(C!==void 0)Qb(C,"playlist");else if(!k.playlists||!k.playlists.length)throw rg("No data for playlist"),Error("No data for playlist");return l.return(k.playlists.map(function(c){return c.offlinePlaylistData}))}})},M1Y=function(B,y,a,r){var k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro;
return g.F(function(iJ){switch(iJ.X){case 1:return g.Q(iJ,vU(),2);case 2:k=iJ.C;if(!k)return iJ.return([]);x=[];if((J=r)==null?0:J.length){x=r;iJ.dQ(3);break}return g.Q(iJ,hn(k,"mainPlaylistEntity"),4);case 4:x=iJ.C;case 3:if(!x.length)return iJ.return([]);m=[];C=Date.now()/1E3;l=g.Y(x);c=l.next();case 5:if(c.done)return m.length?g.Q(iJ,fHY(m),10):iJ.return([]);w=c.value;if(!w.downloadState){E=void 0;iJ.dQ(8);break}return g.Q(iJ,jP(k,w.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:E=
iJ.C;case 8:z=E;q=void 0;b=(L=(q=w)==null?void 0:q.entityMetadata)&&L.nextAutoRefreshIntervalSeconds?Number(L.nextAutoRefreshIntervalSeconds):NaN;S=Number.isNaN(b)?B:b;A=P=void 0;D=((P=z)==null?0:P.lastSyncedTimestampMillis)?Number((A=z)==null?void 0:A.lastSyncedTimestampMillis)/1E3:0;U=M=void 0;n=((M=z)==null?0:M.addedTimestampMillis)?Number((U=z)==null?void 0:U.addedTimestampMillis)/1E3:0;if(a||!L||D+S<=C){xW=[];C4=void 0;if((C4=w.videos)==null?0:C4.length)for(HE=g.Y(w.videos),g$$=HE.next();!g$$.done;g$$=
HE.next())yr=g$$.value,YW=JSON.parse(g.$J(yr).entityId),YW.videoId&&xW.push(YW.videoId);ex="0";L&&(BC=void 0,ex=String(Number((BC=L.offlineLastModifiedTimestampSeconds)!=null?BC:0).toFixed()));ia={playlistId:w.playlistId,videoIds:xW,offlineLastModifiedTimestamp:ex,autoSync:y,offlineDateAddedTimestamp:String(n.toFixed())};m.push(ia)}c=l.next();iJ.dQ(5);break;case 10:return Ro=iJ.C,iJ.return(Ro)}})},$1o=function(){var B,y,a,r,k;
return g.F(function(x){if(x.X==1)return g.Q(x,vU(),2);if(x.X!=3)return(B=x.C)?g.Q(x,hn(B,"refresh"),3):x.return(!1);y=x.C;if((a=y[0])==null||!a.refreshTime)return x.return(!1);r=Number(y[0].refreshTime);k=Date.now()/1E3;return x.return(isFinite(r)&&k>=r)})},IHK=function(B,y){var a,r,k;
return g.F(function(x){switch(x.X){case 1:return g.TU(x,2),g.Q(x,Oh1(B,y),4);case 4:return r=x.C,g.Q(x,LM7(r),5);case 5:a=bhY(r);g.PE(x,3);break;case 2:k=g.Sx(x),rg("getAndProcessSmartDownloadsResponse request or processing error",k);case 3:return x.return(a)}})},ZhS=function(B,y,a,r){var k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro;
return g.F(function(iJ){switch(iJ.X){case 1:return g.Q(iJ,vU(),2);case 2:k=iJ.C;if(!k)return iJ.return([]);x=[];if((J=r)==null?0:J.length){x=r;iJ.dQ(3);break}return g.Q(iJ,hn(k,"musicPlaylist"),4);case 4:x=iJ.C;case 3:if(!x.length)return iJ.return([]);m=[];C=Date.now()/1E3;l=g.Y(x);c=l.next();case 5:if(c.done)return m.length?g.Q(iJ,fHY(m),10):iJ.return([]);w=c.value;E=void 0;q=(z=(E=w)==null?void 0:E.entityMetadata)&&z.nextAutoRefreshIntervalSeconds?Number(z.nextAutoRefreshIntervalSeconds):NaN;L=
Number.isNaN(q)?B:q;S=b=0;P="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!w.downloadMetadata){iJ.dQ(8);break}return g.Q(iJ,jP(k,w.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:A=iJ.C,M=D=void 0,b=Number((M=(D=A)==null?void 0:D.addedTimestampMillis)!=null?M:"0")/1E3,n=U=void 0,S=Number((n=(U=A)==null?void 0:U.lastModifiedTimestampMillis)!=null?n:"0")/1E3,C4=xW=void 0,P=(C4=(xW=A)==null?void 0:xW.syncState)!=null?C4:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:HE=void 0;if(a||P!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!z||Number((HE=z.lastSyncedTimestampSeconds)!=null?HE:0)+L<=C){g$$=[];yr=void 0;if((yr=w.tracks)==null?0:yr.length)for(YW=g.Y(w.tracks),ex=YW.next();!ex.done;ex=YW.next())BC=ex.value,g$$.push(g.$J(BC).entityId);ia={playlistId:w.playlistId,videoIds:g$$,offlineLastModifiedTimestamp:String(S.toFixed()),autoSync:y,offlineDateAddedTimestamp:String(b.toFixed())};m.push(ia)}c=l.next();iJ.dQ(5);break;case 10:return Ro=iJ.C,iJ.return(Ro)}})},Oh1=function(B,y){var a,r,k,x,J,m,C,l,c,w;
return g.F(function(E){switch(E.X){case 1:return a=g.Xy(),g.Q(E,vU(),2);case 2:r=E.C;if(!r){E.dQ(3);break}return g.Q(E,I2C(r),4);case 4:k=E.C;case 3:var z=k;x={context:g.MJ(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:B},offlineClientState:z,clientStateRequestData:{preferredFormatType:y}}}};J=g.Ii(nk1);g.TU(E,5);C={YU:!0};return g.Q(E,g.Ps(a,x,J,void 0,C),7);case 7:m=E.C;g.PE(E,6);break;case 5:l=g.Sx(E);if(l instanceof g.Ws)throw c=
"DPS network manager error for smart downloads: "+l.message,rg(c,l),Error(c);rg("DPS fetch request error for smart downloads",l);throw Error("DPS fetch request error for smart downloads");case 6:w=ST(m);if(m)w!==void 0&&Qb(w,"smart downloads");else throw rg("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return E.return(m)}})},U1V=function(B,y){var a,r,k,x,J,m,C,l;
return g.F(function(c){switch(c.X){case 1:return a=g.Xy(),r={context:g.MJ(),videoPlaybackPositionEntities:B,lastSyncTimestampUsec:y},k=g.Ii(d1I),g.TU(c,2),J={YU:!0},g.Q(c,g.Ps(a,r,k,void 0,J),4);case 4:x=c.C;g.PE(c,3);break;case 2:m=g.Sx(c);if(m instanceof g.Ws)throw C="VPPS network manager error: "+m.message,rg(C,m),Error(C);rg("VPPS fetch request error",m);throw Error("VPPS fetch request error");case 3:l=ST(x);if(x)l!==void 0&&Qb(l,"position sync");else throw rg("Network request failed for position sync"),
Error("Network request failed for position sync");return c.return(x)}})},s9o=function(B,y,a){var r,k,x,J,m,C,l,c;
return g.F(function(w){switch(w.X){case 1:r=g.Xy();var E=a.refreshData,z=a.isEnqueuedForExpiredStreamUrlRefetch,q=a.aX,L=a.offlineSourceData,b=a.mediaCapabilities,S={entityKey:B};E&&(S.refreshData=E);z&&(S.isExpiredStreamUrlRefetch=z);q&&(S.downloadParameters=q);L&&(S.offlineSourceData=L);E={context:g.gA(y),signatureTimestamp:20256,videos:[S]};b&&(E.mediaCapabilities=b);k=E;x=g.Ii(j9o);g.TU(w,2);m={YU:!0};return g.Q(w,g.Ps(r,k,x,void 0,m),4);case 4:J=w.C;g.PE(w,3);break;case 2:C=g.Sx(w);if(C instanceof
g.Ws)throw l="GetPDE network manager error: "+C.message,rg(l,C),Error(l);rg("GetPDE fetch request error",C);throw Error("GetPDE fetch request error");case 3:c=ST(J);if(J)c!==void 0&&Qb(c,"PDE");else throw rg("Network request failed for PDE"),Error("Network request failed for PDE");return w.return(J)}})},ST=function(B){var y;
return(y=B.errorMetadata)==null?void 0:y.status},Qb=function(B,y){y=y?" for "+y:"";
if(B===0)throw B="Empty response body"+y,rg(B),Error(B);B="Response with error"+y;rg(B);throw Error(B);},fHY=function(B){var y,a,r,k,x,J,m,C;
return g.F(function(l){switch(l.X){case 1:return y=g.Xy(),a=i8K(B),r=g.Ii(hIa),g.TU(l,2),x={YU:!0},g.Q(l,g.Ps(y,a,r,void 0,x),4);case 4:k=l.C;g.PE(l,3);break;case 2:J=g.Sx(l);if(J instanceof g.Ws)throw m="offlinePlaylistSyncCheck network manager error: "+J.message,rg(m,J),Error(m);rg("offlinePlaylistSyncCheck fetch request error",J);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:C=ST(k);if(!k)throw rg("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(C!==void 0)Qb(C,"playlist sync");else if(!k.offlinePlaylistSyncCheckDatas||!k.offlinePlaylistSyncCheckDatas.length)throw rg("No data for playlist sync"),Error("No data for playlist sync");return l.return(k.offlinePlaylistSyncCheckDatas.map(function(c){return c.offlinePlaylistSyncCheckData}))}})},AF=function(B){this.C=B},vk7=function(B,y){var a,r,k,x,J,m;
return g.F(function(C){switch(C.X){case 1:a=new Map,r=g.Y(y),k=r.next();case 2:if(k.done){C.dQ(4);break}x=k.value;J=a;m=J.set;return g.Q(C,B.X(x),5);case 5:m.call(J,x,C.C);k=r.next();C.dQ(2);break;case 4:return C.return(a)}})},FP=function(B,y,a,r,k,x){y=g.Oh(y,a);
r=Object.assign({},x,{priority:r,retryScheduleIntervalsInSeconds:k});return{actionType:B,entityKey:y,actionMetadata:r}},Gb=function(B,y,a,r,k,x){this.status=B;
this.C=y;this.J=a;this.X=r;this.D=k;this.downloadState=x},Bmp=function(B,y,a){this.C=B;
this.Pk=y;this.D=a},rCu=function(B,y){var a,r,k,x,J,m,C,l,c;
return g.F(function(w){switch(w.X){case 1:return a=y.entityKey,k=(r=g.f(y.actionMetadata,eT))==null?void 0:r.isEnqueuedForExpiredStreamUrlRefetch,g.TU(w,2),x=void 0,g.Q(w,yCO(B,y),4);case 4:x=w.C;g.TU(w,5);var E=(E=g.f(y.actionMetadata,eT))?{maximumDownloadQuality:E.maximumDownloadQuality}:void 0;return g.Q(w,s9o(a,B.Pk,{isEnqueuedForExpiredStreamUrlRefetch:k,aX:E,offlineSourceData:x}),7);case 7:J=w.C;g.PE(w,6,2);break;case 5:return g.Sx(w,2),m=on(y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",rg("PDE handleAdd error"),w.return(Ds(y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",m,"DOWNLOAD_STATE_FAILED"));case 6:return g.Q(w,atS(B,J,y),8);case 8:return w.return(Ds(y,!0,J.orchestrationActions));case 2:return C=g.Sx(w),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.HL&&C.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),rg("PDE handleAdd error"),w.return(Ds(y,!1,void 0,l,c,"DOWNLOAD_STATE_FAILED"))}})},JCO=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4;
return g.F(function(HE){switch(HE.X){case 1:return a=y.entityKey,r=g.$J(a).entityId,g.Q(HE,dw(B.C,{mode:"readonly",Ei:!0},function(g$$){var yr=fd(g$$,a,"playbackData"),YW=fd(g$$,g.Oh(r,"offlineVideoPolicy"),"offlineVideoPolicy");g$$=fd(g$$,g.Oh(r,"transfer"),"transfer");return g.wj.all([yr,YW,g$$])}),2);
case 2:k=HE.C;x=g.Y(k);J=x.next().value;m=x.next().value;C=x.next().value;l=J;c=m;w=C;if(!l||!c)return HE.return(Ds(y,!0));E=[];L=((q=l)==null?0:q.playerResponseJson)?JSON.parse(l.playerResponseJson):null;if(!(w&&L&&B.Pk.Z("html5_refresh_deprecated_downloads"))){HE.dQ(3);break}z=kgY(B,L,w);return g.Q(HE,xvK(B,w),4);case 4:E=HE.C;case 3:b={lastPlayerResponseTimestampSeconds:l.playerResponseTimestamp,offlineToken:c.offlineToken,formatIds:E};S={};if((P=w)==null?0:P.maximumDownloadQuality)S.maximumDownloadQuality=
w.maximumDownloadQuality;g.TU(HE,5);A=void 0;return g.Q(HE,yCO(B,y),7);case 7:return A=HE.C,g.TU(HE,8),g.Q(HE,s9o(a,B.Pk,{refreshData:b,aX:S,offlineSourceData:A,mediaCapabilities:z}),10);case 10:D=HE.C;g.PE(HE,9,5);break;case 8:return g.Sx(HE,5),M=on(y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",rg("PDE handleRefresh error"),HE.return(Ds(y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",M,
"DOWNLOAD_STATE_FAILED"));case 9:return g.Q(HE,atS(B,D,y),11);case 11:return HE.return(Ds(y,!0,D.orchestrationActions));case 5:return U=g.Sx(HE),n="PDE handleRefresh error",U instanceof Error&&(n="PDE handleRefresh error: "+U.message),xW="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C4="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.HL&&U.type==="QUOTA_EXCEEDED"&&(xW="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C4="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
rg(n),HE.return(Ds(y,!1,void 0,xW,C4,"DOWNLOAD_STATE_FAILED"))}})},yCO=function(B,y){var a,r,k,x;
return g.F(function(J){if(J.X==1)return a=g.$J(y.entityKey).entityId,r=g.Oh(a,"videoDownloadContextEntity"),g.Q(J,jP(B.C,r,"videoDownloadContextEntity"),2);k=J.C;return(x=k)!=null&&x.offlineModeType?J.return({offlineModeType:k.offlineModeType}):J.return(void 0)})},atS=function(B,y,a){var r,k,x,J,m;
return g.F(function(C){if(C.X==1){if(!y.frameworkUpdates||!g.f(y.frameworkUpdates,Nd))return C.return();if(!(g.f(y.frameworkUpdates,Nd).mutations&&g.f(y.frameworkUpdates,Nd).mutations.length>0&&g.f(y.frameworkUpdates,Nd).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return C.dQ(2);r=g.$J(g.f(y.frameworkUpdates,Nd).mutations[0].entityKey).entityId;return g.Q(C,bO(B.C,r),3)}if(C.X!=2){k=C.C;x=g.f(a.actionMetadata,eT);if(m=(J=x)==null?void 0:J.playlistId)k.playlistId=m;k.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.oy(B.Pk)?g.Q(C,LA(r,B.C,a,B.D,k),2):g.tM(B.Pk)?g.Q(C,Tb(r,B.C,a,B.D),2):C.dQ(2)}return g.Q(C,P$o(g.f(y.frameworkUpdates,Nd)),0)})},Ds=function(B,y,a,r,k,x){return new Gb(y?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",on(B),a,r,k,x)},kgY=function(B,y,a){y=cXo(B.Pk,a.cotn,y);
a=g.YC(y);return g.BU$(y,a,B.Pk)},xvK=function(B,y){var a,r,k,x,J,m,C,l,c,w,E;
return g.F(function(z){if(z.X==1)return a=[],g.Q(z,dw(B.C,{mode:"readonly",Ei:!0},function(q){var L=[],b=y.offlineVideoStreams;if(b){b=g.Y(b);for(var S=b.next();!S.done;S=b.next())L.push(fd(q,S.value,"offlineVideoStreams"))}return g.wj.all(L)}),2);
if(r=z.C)for(k=g.Y(r),x=k.next();!x.done;x=k.next())if(J=x.value,m=void 0,(m=J)==null?0:m.streamsProgress)for(C=J.streamsProgress,l=0;l<C.length;l++)c=C[l],w=JSON.parse(c.formatStreamBytes),E={itag:w.itag,lmt:w.lastModified,xtags:w.xtags},a.push(E);return z.return(a)})},HXI=function(B,y){this.C=B;
this.Pk=y},mvp=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z;
return g.F(function(q){switch(q.X){case 1:return a=on(y),g.Q(q,hn(B.C,"videoPlaybackPositionEntity"),2);case 2:r=q.C;if(r.length===0)return q.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.TU(q,3);return g.Q(q,Kd.getInstance(),5);case 5:k=q.C;if(!k)throw Error("prefStorage is undefined");return g.Q(q,k.get("psi"),6);case 6:return x=q.C,C=(m=(J=x)==null?void 0:J.xN)!=null?m:"0",g.Q(q,U1V(r,C),7);case 7:return l=q.C,c={isPaused:l.watchHistoryPaused,xN:l.syncTimestampUsec},g.Q(q,k.set("psi",
c),8);case 8:if(c.isPaused){q.dQ(9);break}w=g.f(l.frameworkUpdates,Nd);if(!l.frameworkUpdates||!w){q.dQ(9);break}return g.Q(q,P$o(w),9);case 9:g.PE(q,4);break;case 3:return E=g.Sx(q),z="PPE handleRefresh error: "+(E instanceof Error?E.message:"unknown error"),rg(z),q.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return q.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},CfY=function(B,y){var a,r,k,x,J,m,C,l;
return g.F(function(c){switch(c.X){case 1:return a=on(y),r=g.$J(y.entityKey).entityId,g.TU(c,2),g.Q(c,Kd.getInstance(),4);case 4:k=c.C;if(!k)throw Error("prefStorage is undefined");return g.Q(c,k.get("psi"),5);case 5:x=c.C;J=g.f(y.actionMetadata,ohY);if(((m=x)==null?void 0:m.isPaused)!==!1||(C=J)==null||!C.lastPlaybackPositionSeconds){c.dQ(6);break}l={key:g.Oh(r,"videoPlaybackPositionEntity"),videoId:r,lastPlaybackPositionSeconds:J.lastPlaybackPositionSeconds};return g.Q(c,Uu(B.C,l,"videoPlaybackPositionEntity"),
6);case 6:g.PE(c,3);break;case 2:return g.Sx(c),c.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},ghC=function(B,y){var a,r,k;
return g.F(function(x){switch(x.X){case 1:a=on(y);g.TU(x,2);r=g.$J(y.entityKey).entityId;if(r==="!*$_ALL_ENTITIES_!*$")return g.Q(x,NaY(B.C),5);k=g.Oh(r,"videoPlaybackPositionEntity");return g.Q(x,Laa(B.C,k),5);case 5:g.PE(x,3);break;case 2:return g.Sx(x),x.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},ltY=function(B,y){this.api=B;
this.C=y;this.logger=new g.wM("woffle");this.X=!1;this.H6={Xh:this.Xh};this.logger.debug("Initialized OfflineMediaManager")},cCu=function(B){return g.F(function(y){return y.return(DHS(B))})},wDV=function(B){var y;
return g.F(function(a){if(a.X==1)return g.Q(a,g.Pmx(B),2);y=a.C;return a.return(y.filter(function(r){return!!r.url}).map(function(r){return r.url}))})},WW=function(B,y){var a=g.Oz(y);
if(a===1||a===0)return Promise.resolve();(a=Eh0(B,y))&&a.stopVideo();B.D=0;return cCu(y)},KA=function(B,y,a,r){a=a===void 0?!1:a;
r=r===void 0?!0:r;var k=typeof y==="string"?y:y.videoDetails.videoId;g.Oz(k)===2&&((y=Eh0(B,k))?y.stopVideo():B.logger.info(function(){return"Corresponding player for "+k+" not found. Pausing anyway"}),g.Iy(k,2),B.D=2,a?zGC(B.C):r&&qGK(B.C))},Eh0=function(B,y){var a;
return((a=B.player)==null?void 0:a.getVideoData().videoId)===y?B.player:null},VUu=function(B,y,a){y.getPlayerResponse();
g.Iy(y.videoId,2);B.D=2;B.X=!1;var r;(r=B.player)==null||r.dispose();B.player=B.api.hP(y);y={};B.player.dw((y.localmediachange=B.tH,y.signatureexpired=B.uK,y.statechange=B.y77,y),B);var k=B.Xh(a);B.player.ib(g.uM(k,k,!0,"m"),!1);B.logger.debug(function(){return"Starting headless playback with quality: "+k});
B.player.R9(!1)},RGK=function(B,y){this.C=B;
this.Pk=y},YGI=function(B,y){var a,r;
return g.F(function(k){switch(k.X){case 1:return a=on(y),g.Q(k,jP(B.C,y.entityKey,"transfer"),2);case 2:if(r=k.C)return k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.TU(k,3);return g.Q(k,uMC(B,y),5);case 5:g.PE(k,4);break;case 3:return g.Sx(k),k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},LOK=function(B,y){var a,r;
return g.F(function(k){switch(k.X){case 1:return a=on(y),g.Q(k,jP(B.C,y.entityKey,"transfer"),2);case 2:r=k.C;if(!r||r.transferState!=="TRANSFER_STATE_COMPLETE")return k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.TU(k,3);return g.Q(k,uMC(B,y,!0),5);case 5:g.PE(k,4);break;case 3:return g.Sx(k),k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},NmS=function(B,y){var a,r,k,x,J,m,C,l,c,w;
return g.F(function(E){switch(E.X){case 1:return a=on(y),r=g.$J(y.entityKey).entityId,g.Q(E,dw(B.C,{mode:"readonly",Ei:!0},function(z){var q=fd(z,y.entityKey,"transfer");z=fd(z,g.Oh(r,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.wj.all([q,z])}),2);
case 2:k=E.C;x=g.Y(k);J=x.next().value;m=x.next().value;C=J;l=m;if(!C||C.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return E.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.TU(E,3);C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.Q(E,Uu(B.C,C,"transfer"),5);case 5:c=g.$J(C.key).entityId;Hh7({videoId:c,Jm:C,offlineModeType:(w=l)==null?void 0:w.offlineModeType});g.PE(E,4);break;case 3:return g.Sx(E),E.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return E.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},uMC=function(B,y,a){a=a===void 0?!1:a;
var r,k,x,J,m,C,l,c,w,E,z,q,L,b,S;return g.F(function(P){switch(P.X){case 1:return r=g.f(y.actionMetadata,bXS),k=g.$J(y.entityKey).entityId,x=g.Oh(k,"downloadStatusEntity"),g.Q(P,dw(B.C,{mode:"readonly",Ei:!0},function(A){var D=fd(A,x,"downloadStatusEntity");A=fd(A,g.Oh(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.wj.all([D,A])}),2);
case 2:return J=P.C,m=g.Y(J),C=m.next().value,l=m.next().value,c=C,w=l,E="TRANSFER_STATE_TRANSFER_IN_QUEUE",((z=c)==null?void 0:z.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(E="TRANSFER_STATE_PAUSED_BY_USER"),b={key:y.entityKey,transferState:E,cotn:g.CM(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(q=r)==null?void 0:q.maximumDownloadQuality,preferredAudioTrack:(L=r)==null?void 0:L.preferredAudioTrack,transferRetryCount:0,isRefresh:a,hasLoggedFirstStarted:!1},g.Q(P,dw(B.C,
{mode:"readwrite",Ei:!0},function(A){var D=[];a&&D.push(Iw(A,g.Oh(k,"offlineVideoStreams")));D.push(Ou(A,b,"transfer"));return g.wj.all(D)}),3);
case 3:if(!a){P.dQ(4);break}return g.Q(P,cCu(k),4);case 4:x1K({videoId:k,Jm:b,offlineModeType:(S=w)==null?void 0:S.offlineModeType}),g.bJ(P)}})},pDp=function(B,y,a,r){if(!B.action.entityKey)throw Error("entityKey is missing.");
var k=g.$J(B.action.entityKey);k={entityType:k.DX,entityId:k.entityId,offlineOrchestrationActionType:B.action.actionType,orchestrationAction:{orchestrationActionId:B.actionId}};y&&(k.offlineOrchestrationActionResult=y.status,k.isRetryable=a?!1:y.C,y.D&&(k.offlineOrchestrationFailureReason=Tm1(y.D,k.isRetryable)));var x,J;if((x=B.action.actionMetadata)==null?0:(J=x.offlineLoggingData)==null?0:J.offlineModeType)k.offlineModeType=B.action.actionMetadata.offlineLoggingData.offlineModeType;r&&(k.additionalOrchestrationActions=
r.map(function(m){return{orchestrationActionId:m.actionId}}));
return k},Tm1=function(B,y){return B!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||y?B==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&y?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":B:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},tUO=function(B,y){var a={offlineOrchestrationContext:pDp(B)};
y=$HS(y,a);O80(Mk0(),y,B.rootActionId)},PfI=function(B,y,a,r){r=r===void 0?[]:r;
y={offlineOrchestrationContext:pDp(B,y,a,r)};y=$HS(3,y);O80(Mk0(),y,B.rootActionId)},SGY=function(){this.actions=[]},QJ7=function(B,y){y=g.Y(y);
for(var a=y.next();!a.done;a=y.next())a=a.value,tUO(a,1),B.actions.push(a);B.actions.sort(B.C)},ACK=function(B,y){if(y)for(var a=0;a<B.actions.length;a++)if(y==="!*$_ALL_ENTITIES_!*$"&&B.actions[a].actionId!==y||y!=="!*$_ALL_ENTITIES_!*$"&&B.actions[a].rootActionId===y&&B.actions[a].actionId!==y)B.actions.splice(a,1),a--},FOS=function(B,y){B=g.Y(B.actions);
for(var a=B.next();!a.done;a=B.next())if(a.value.actionId===y)return!0;return!1},iO=function(B,y,a,r,k){g.W.call(this);
var x=this;this.X=B;this.Xx=y;this.R7=a;this.N=r;this.Pk=k;this.C=new SGY;this.T=new g.ey;this.D=new g.Mv(function(){x.retry()});
this.K=NaN;this.j=!1;this.H6={a8f:function(){return x.C},
fY:function(){return x.T},
DEw:function(){return x.D},
retry:function(){return x.retry()}};
g.K(this,this.D);this.U=this.X.observe(this.Ch.bind(this))},DvK=function(B,y,a,r,k){var x;
return g.F(function(J){if(J.X==1)return x=new iO(B,y,a,r,k),g.Q(J,Gg0(x),2);eGa(x);return J.return(x)})},eGa=function(B){var y=B.C.actions[0];
return B.J?((y==null?void 0:y.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&B.J[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(B.j=!0),Promise.resolve()):WO0(B)},WO0=function(B){var y,a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S;
return g.F(function(P){switch(P.X){case 1:if(B.J)throw Error("Already processing an action");if(B.fh())return P.return();y=B.C.actions.shift();rXo(B.R7,!y);if(y===void 0)return P.return();y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&y.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&ACK(B.C,y.actionId);a="";y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&y.rootActionId===y.actionId&&(a=y.actionId);r=[y];B.J=r;if(k=B.Xx[y.entityType]){P.dQ(2);break}B.J=
void 0;return g.Q(P,WO0(B),3);case 3:return P.return();case 2:x=g.Y(r);for(J=x.next();!J.done;J=x.next())m=J.value,tUO(m,2);g.TU(P,4,5);return g.Q(P,vk7(k,r.map(function(A){return A.action})),7);
case 7:C=P.C,l=g.Y(r),c=l.next();case 8:if(c.done){P.dQ(10);break}w=c.value;E=C.get(w.action);return g.Q(P,KOC(B,w,E),9);case 9:c=l.next();P.dQ(8);break;case 10:ACK(B.C,a);case 5:g.GU(P);B.J=void 0;g.DZ(P,6);break;case 4:return z=g.Sx(P),rg("Orchestration error",z),g.TU(P,12),g.Q(P,iXu(B,r),14);case 14:g.PE(P,5);break;case 12:q=g.Sx(P);rg("Orchestration retry error",q);L=g.Y(r);for(b=L.next();!b.done;b=L.next())S=b.value,S.retryScheduleIndex<3&&QJ7(B.C,[S]);P.dQ(5);break;case 6:return g.Q(P,WO0(B),
0)}})},KOC=function(B,y,a){var r,k,x,J,m,C,l,c,w,E,z,q;
return g.F(function(L){switch(L.X){case 1:r=y.retryScheduleIndex+2===3;if(a.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){L.dQ(2);break}if(a.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){L.dQ(0);break}PfI(y,a,r);if(a.C&&y.retryScheduleIndex+1<3)return g.Q(L,iXu(B,[y]),0);x=((k=a)==null?0:k.X)?a.X:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";J={entityKey:y.action.entityKey,failureReason:x};m=void 0;g.oy(B.Pk)?m="mainVideoDownloadStateEntity":g.tM(B.Pk)&&(m="musicTrackDownloadMetadataEntity");
if(!m||!a.downloadState){L.dQ(7);break}C=g.$J(y.action.entityKey).entityId;return g.Q(L,cW(C,m,B.X,a.downloadState),7);case 7:xl(B.N,J);if(a.downloadState==="DOWNLOAD_STATE_FAILED"&&B.Pk.Z("html5_auto_retry_failed_pde_actions")){L.dQ(0);break}rg("Orchestration result is not retryable, deleting action");return g.Q(L,Laa(B.X,Rn(y).key),0);case 2:l=void 0;try{l=(c=a.J)==null?void 0:c.map(function(b){return B.createAction(b,y)})}catch(b){return PfI(y,a,r),w={entityKey:y.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},xl(B.N,w),rg("Orchestration subactions creation error",b),L.return()}PfI(y,a,r,l);if(!l){L.dQ(12);break}E=l.map(function(b){return Rn(b)});
z=0;case 13:if(!(z<l.length)||B.j){L.dQ(15);break}return g.Q(L,dw(B.X,{mode:"readwrite",Ei:!0},function(b){var S=[];S.push(l2p(b,E.slice(z,z+10),"offlineOrchestrationActionWrapperEntity"));return g.wj.all(S)}),16);
case 16:z+=10;L.dQ(13);break;case 15:if(B.j)return B.j=!1,L.return();case 12:return q=Rn(y),g.Q(L,Laa(B.X,q.key),17);case 17:tUO(y,4),g.bJ(L)}})},$vY=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z;
return g.F(function(q){a=[];r=Infinity;k=4E3;x=g.Y(y);for(J=x.next();!J.done;J=x.next())m=J.value,C=Number(m.enqueueTimeSec),l=XDV(C),c=m.retryScheduleIndex,w=c!=null&&c>0,l>0&&w?(r=Math.min(r,C),k=Math.min(l,k)):a.push(m);isFinite(r)&&(!B.D.isActive()||r<B.K)&&(B.K=r,B.D.start(k));B.T.qa()||(E=a.length,a=a.filter(function(L){var b;L=((b=L.actionProto)==null?void 0:b.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!ftC.includes(L)}),z=a.length<E,!B.D.isActive()&&z&&B.D.start(1));
a.length>0&&MUV(B,a);return g.Q(q,eGa(B),0)})},ItV=function(B){var y,a,r,k,x,J,m;
return g.F(function(C){if(C.X==1)return g.Q(C,OXI(B),2);y=C.C;a=[];r=g.Y(y);for(k=r.next();!k.done;k=r.next())x=k.value,J=g.$J(x.key),m=J.entityId,FOS(B.C,m)||a.push(x);return g.Q(C,$vY(B,a),0)})},XDV=function(B){B=B*1E3-Date.now();
return B>4E3?4E3:B},iXu=function(B,y){var a,r,k;
return g.F(function(x){a=g.Y(y);for(r=a.next();!r.done;r=a.next()){k=r.value;var J=void 0,m=void 0,C=((m=k.action)==null?void 0:(J=m.actionMetadata)==null?void 0:J.retryScheduleIntervalsInSeconds)||[1,2,4];J=1;k.retryScheduleIndex<C.length&&(J=C[k.retryScheduleIndex]);k.C=J*1E3+Date.now();k.retryScheduleIndex++}return g.Q(x,ZXO(B,y),0)})},Gg0=function(B){var y;
return g.F(function(a){if(a.X==1)return g.Q(a,hn(B.X,"offlineOrchestrationActionWrapperEntity"),2);y=a.C;return g.Q(a,$vY(B,y),0)})},MUV=function(B,y){y.length!==0&&y.forEach(function(a){a=Vb(a);
a.retryScheduleIndex<3&&QJ7(B.C,[a])})},OXI=function(B,y){var a;
return g.F(function(r){if(r.X==1)return g.Q(r,hn(B.X,"offlineOrchestrationActionWrapperEntity",y),2);a=r.C;return r.return(a.filter(SHV))})},ZXO=function(B,y){if(y.length===0)return Promise.resolve([]);
y=y.map(function(a){return Rn(a)});
return YHV(B.X,y)},nhK=function(B){this.Fx=B;
this.C=void 0},dvV=function(B,y){var a,r,k,x;
return g.F(function(J){a=y.videoId;r=!0;if(y.captionTracks.length)k=JaK(y),B.C=new g.pT(B.Fx,y,k);else if(y.ek)x=g.iq4(y),B.C=new g.Pc(B.Fx,y.ek,a,x,y.v7,y.eventId),r=y.v7;else return J.return();return J.return(new Promise(function(m){var C;(C=B.C)==null||C.u2({VN:function(){return g.F(function(l){if(l.X==1)return g.Q(l,B.VN(a,r),2);m();g.bJ(l)})},
IF:function(){}})}))})},UvI=function(B){var y;
return g.F(function(a){if(a.X==1)return g.Q(a,eCK(B),2);y=a.C;return a.return(!!y&&y.length>0)})},XP=function(B){g.W.call(this);
this.C=B;this.X=this.C.observe(this.D.bind(this))},jJC=function(B,y){var a,r,k,x,J,m,C;
return g.F(function(l){switch(l.X){case 1:if(y.length===0)return l.return([]);a=y.map(function(c){return g.Oh(c,"transfer")});
return g.Q(l,hn(B.C,"transfer",a),2);case 2:r=l.C;k=r.filter(SHV).map(function(c){return g.$J(c.key).entityId});
x=y.filter(function(c){return k.indexOf(c)===-1});
if(x.length===0)return l.return([]);J=g.Y(x);m=J.next();case 3:if(m.done){l.dQ(5);break}C=m.value;return g.Q(l,cCu(C),4);case 4:m=J.next();l.dQ(3);break;case 5:return l.return(x)}})},vhY=function(B,y,a,r,k,x){var J,m,C;
return g.F(function(l){J="STREAM_TYPE_UNKNOWN";a.video&&a.audio?(J="STREAM_TYPE_AUDIO_AND_VIDEO",rg("unexpected stream type")):a.video&&!a.audio?J="STREAM_TYPE_VIDEO":!a.video&&a.audio&&(J="STREAM_TYPE_AUDIO");m=g.Oh(y,"offlineVideoStreams");C={numBytesDownloaded:k.toFixed(),numTotalBytes:x.toFixed(),streamType:J,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(r),itag:J==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(a.itag):void 0};return g.Q(l,dw(B,{mode:"readwrite",Ei:!0},
function(c){var w=fd(c,m,"offlineVideoStreams"),E=fd(c,g.Oh(y,"transfer"),"transfer");return g.wj.all([w,E]).then(function(z){z=g.Y(z);var q=z.next().value;z=z.next().value;if(!z)return Iw(c,m).then(function(){});
var L=sJO(q);q=hG7(q,r,C,m);var b=Ou(c,q,"offlineVideoStreams");sJO(q)>L&&(z.lastProgressTimeMs=Date.now().toString());L=[b];z.offlineVideoStreams||(z.offlineVideoStreams=[]);z.offlineVideoStreams.indexOf(m)===-1&&(z.offlineVideoStreams.push(m),L.push(Ou(c,z,"transfer")));return g.wj.all(L)})}),0)})},BG0=function(B,y){var a,r,k,x,J;
return g.F(function(m){if(m.X==1)return a=g.Oh(y,"offlineVideoStreams"),g.Q(m,jP(B,a,"offlineVideoStreams"),2);r=m.C;if(!r||!r.streamsProgress)return m.return();k=g.Y(r.streamsProgress);for(x=k.next();!x.done;x=k.next())J=x.value,J.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",J.numTotalBytes!==J.numBytesDownloaded&&(J.numBytesDownloaded=J.numTotalBytes);return g.Q(m,Uu(B,r,"offlineVideoStreams"),0)})},hG7=function(B,y,a,r){if(B&&B.streamsProgress){r=B;
a:{y=y.itag+";"+y.xtags;for(var k=B.streamsProgress,x=0;x<k.length;x++){var J=JSON.parse(k[x].formatStreamBytes);if(J.itag+";"+J.xtags===y){k[x]=a;a=k;break a}}k.push(a);a=k}r.streamsProgress=a}else B={key:r,streamsProgress:[a]};return B},sJO=function(B){if(B==null?0:B.streamsProgress){var y=0;
B=B.streamsProgress;for(var a=0;a<B.length;a++){var r=B[a];isNaN(Number(r.numBytesDownloaded))?rg("stream progress bytes number invalid"):y+=Number(r.numBytesDownloaded)}return y}return 0},y_1=function(B,y,a,r){g.W.call(this);
var k=this;this.X=B;this.api=y;this.s0=a;this.Ch=r;this.T=new g.ey;this.J=new g.Mv(function(){k.C&&k.C.transferState==="TRANSFER_STATE_TRANSFERRING"&&k.T.qa()&&((k.C.transferRetryCount||0)<3?KA(k.N,k.j,!1,!1):WW(k.N,k.j.videoDetails.videoId),k.wJ("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.R7=this.t7=0;this.U=this.K=!1;this.rQ=g.d2(this.api.Y().experiments,"html5_transfer_processing_logs_interval");this.E0=new g.qO(this);this.H6={vUm:function(){return k.J},
UJz:function(){return k.Ch},
fY:function(){return k.T}};
this.Xx=this.X.observe(this.fm.bind(this));this.N=new ltY(y,this);this.QO=new nhK(y);this.J7=new XP(this.X);this.vk=this.T.listen("publicytnetworkstatus-online",this.Xd.bind(this));this.uw=this.T.listen("publicytnetworkstatus-offline",this.zMf.bind(this));this.U=this.api.Y().Z("html5_less_transfer_processing_logs");g.K(this,this.E0);this.E0.L(y,"offlinetransferpause",this.TzQ);if(g.oy(this.api.Y()))this.D="mainVideoDownloadStateEntity";else if(g.tM(this.api.Y())||g.gC(this.api.Y()))this.D="musicTrackDownloadMetadataEntity"},
anV=function(B){return g.F(function(y){if(y.X==1)y=g.Q(y,Fa0(),2);
else{var a=B.J7;var r=g.$N();r=Object.keys(r);a=jJC(a,r);y=g.Q(y,a,0)}return y})},Md=function(B,y){y=y===void 0?!1:y;
var a;return g.F(function(r){if(r.X==1){if(B.C)throw Error("Already downloading a video");B.R7=0;B.K=!1;return g.Q(r,r_p(B),2)}return r.X!=4?(a=r.C,kRu(B.s0,!a),a&&B.T.qa()?y?g.Q(r,new Promise(function(k){g.HA(k,1E3)}),4):r.dQ(4):(!a&&B.C&&fA(B),r.dQ(0))):g.Q(r,kTY(B,a),0)})},x51=function(B){return g.F(function(y){if(y.X==1)return B.j?g.Q(y,WW(B.N,B.j.videoDetails.videoId),3):y.dQ(0);
fA(B);g.bJ(y)})},J_I=function(B,y){var a,r,k;
return g.F(function(x){switch(x.X){case 1:return g.TU(x,2),(a=!!y.captionTracks.length||!!y.ek)?g.Q(x,UvI(y.videoId),4):x.return();case 4:return(r=x.C)?x.return():g.Q(x,dvV(B.QO,y),5);case 5:g.PE(x,0);break;case 2:k=g.Sx(x),rg("Caption downloading error",k,y.cotn),g.bJ(x)}})},kTY=function(B,y){var a,r,k,x,J,m;
return g.F(function(C){switch(C.X){case 1:if(B.K)return C.return();B.K=!0;B.C=y;a=g.$J(B.C.key);r=a.entityId;k=void 0;if(B.C.transferState==="TRANSFER_STATE_TRANSFERRING")return g.Q(C,$l(B,r),7);if(B.C.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||B.C.transferRetryCount||B.C.hasLoggedFirstStarted){C.dQ(3);break}return g.Q(C,$l(B,r),5);case 5:return k=C.C,B.C.hasLoggedFirstStarted=!0,g.Q(C,H$O(B),6);case 6:JXu({videoId:r,Jm:B.C,offlineModeType:k},void 0,void 0,!0);C.dQ(3);break;case 7:k=C.C,
mc({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:r,Jm:B.C,offlineModeType:k});case 3:return g.Q(C,m5p(B),8);case 8:return x=null,g.TU(C,9),g.Q(C,oia(B,y),11);case 11:x=C.C;B.j=x;g.PE(C,10);break;case 9:return J=g.Sx(C),rg("error getting player response",J,y.cotn),g.Q(C,B.wJ("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return C.return();case 10:return m=cXo(B.api.Y(),y.cotn,x),g.Q(C,J_I(B,m),13);case 13:return g.Q(C,wDV(m.videoId),
14);case 14:m.ea=C.C,VUu(B.N,m,y.maximumDownloadQuality),B.J.start(108E5),g.bJ(C)}})},r_p=function(B){var y,a;
return g.F(function(r){if(r.X==1)return g.Q(r,hn(B.X,"transfer"),2);y=r.C;a=y.filter(CWK).sort(giS);return a.length===0?r.return():r.return(a[0])})},m5p=function(B){var y,a,r;
return g.F(function(k){if(k.X==1){if(!B.C)return OQ(B,"onTransferStart"),k.return();B.J.start(108E5);return g.Q(k,In(B,"TRANSFER_STATE_TRANSFERRING"),2)}y=B.C;return(r=((a=y)==null?0:a.key)?g.$J(y.key).entityId:"")&&B.D?g.Q(k,cW(r,B.D,B.X,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):k.dQ(0)})},zGC=function(B){var y,a,r,k;
g.F(function(x){switch(x.X){case 1:if(!B.C){OQ(B,"onTransferPausedByUser");x.dQ(2);break}y=B.C;B.J.stop();return g.Q(x,In(B,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:r=((a=y)==null?0:a.key)?g.$J(y.key).entityId:"";if(!r||!B.D){x.dQ(4);break}return g.Q(x,cW(r,B.D,B.X,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.Q(x,$l(B,r),6);case 6:k=x.C,m1K({videoId:r,Jm:y,offlineModeType:k});case 2:fA(B),Md(B),g.bJ(x)}})},qGK=function(B){var y,a,r;
g.F(function(k){if(k.X==1){if(!B.C)return OQ(B,"onTransferPausedByNetwork"),k.return();B.J.stop();return g.Q(k,In(B,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(k.X!=3)return y=B.C,(r=((a=y)==null?0:a.key)?g.$J(y.key).entityId:"")&&B.D?g.Q(k,cW(r,B.D,B.X,"DOWNLOAD_STATE_PAUSED"),3):k.dQ(3);fA(B);g.bJ(k)})},lnS=function(B){var y,a,r,k,x;
g.F(function(J){switch(J.X){case 1:if(!B.C)return OQ(B,"onTransferComplete"),J.return();y=B.C;B.J.stop();if(!y||!B.j){J.dQ(2);break}a=cXo(B.api.Y(),y.cotn,B.j);return g.Q(J,J_I(B,a),2);case 2:return g.Q(J,In(B,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:k=((r=y)==null?0:r.key)?g.$J(y.key).entityId:"";if(!k||!B.D){J.dQ(5);break}return g.Q(J,cW(k,B.D,B.X,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.Q(J,BG0(B.X,k),7);case 7:return g.Q(J,$l(B,k),8);case 8:x=J.C,mc({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:k,Jm:y,offlineModeType:x}),fA(B),Md(B),g.bJ(J)}})},c_C=function(B,y,a){var r,k;
g.F(function(x){switch(x.X){case 1:if(!B.C)return OQ(B,"onTransferProgress: "+y),x.return();if(B.C.transferState==="TRANSFER_STATE_TRANSFERRING"){x.dQ(2);break}return g.Q(x,m5p(B),2);case 2:r=Date.now();if(!(r-B.t7>1E3)){x.dQ(4);break}B.t7=r;return g.Q(x,vhY(B.X,a.videoId,a.X,a.n6,a.bytesDownloaded,a.C),5);case 5:if(B.U&&!(B.U&&r-B.R7>B.rQ)){x.dQ(4);break}B.R7=r;return g.Q(x,$l(B,y),7);case 7:k=x.C,JXu({videoId:y,Jm:B.C,offlineModeType:k},a.bytesDownloaded,a.C);case 4:B.J.start(108E5),g.bJ(x)}})},
w1u=function(B){var y=(B.C.transferRetryCount||0)<3;
y&&(B=B.C,B.transferRetryCount=(B.transferRetryCount||0)+1);return y},EiC=function(B,y){y=y===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":y;
var a,r,k,x;return g.F(function(J){if(J.X==1)return B.C||OQ(B,"setTransferToFailed: "+y),a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y==="TRANSFER_FAILURE_REASON_NETWORK"?a="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":y==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.Q(J,In(B,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",y),2);if(J.X!=3)return xl(B.Ch,{entityKey:(r=B.C)==null?void 0:r.key,failureReason:a}),
k=B.C?g.$J(B.C.key).entityId:"",g.Q(J,$l(B,k),3);x=J.C;var m={videoId:k,Jm:B.C,offlineModeType:x},C=y,l={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};C&&(l.transferFailureReason=C,l.failureReason=okI(C));mc(l,m);g.bJ(J)})},In=function(B,y,a,r){var k;
return g.F(function(x){if(x.X==1){if(!B.C)return OQ(B,"saveTransferState: "+y),x.return();B.C.transferState=y;B.C.failureReason=r;g.TU(x,2);return g.Q(x,H$O(B,function(J){return a?MX(J,"offlineVideoStreams",B.C.offlineVideoStreams).then(function(m){for(var C=g.Y(m),l=C.next();!l.done;l=C.next())if((l=l.value)&&l.streamsProgress){l=g.Y(l.streamsProgress);for(var c=l.next();!c.done;c=l.next())c.value.streamState=a}return l2p(J,m.filter(function(w){return!!w}),"offlineVideoStreams")}):g.wj.resolve(void 0)}),
4)}if(x.X!=2)return g.PE(x,0);
k=g.Sx(x);return k instanceof g.HL&&k.type==="QUOTA_EXCEEDED"?g.Q(x,B.wJ("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):x.dQ(0)})},H$O=function(B,y){var a;
return g.F(function(r){if(!B.C)return r.return();a=B.C;return g.Q(r,dw(B.X,{mode:"readwrite",Ei:!0},function(k){var x=[Ou(k,a,"transfer")];y&&x.push(y(k));return g.wj.all(x)}),0)})},fA=function(B){B.C=void 0;
B.j=void 0;B.J.stop()},oia=function(B,y){var a,r,k,x,J;
return g.F(function(m){if(m.X==1)return a=g.$J(y.key),r=a.entityId,k=g.Oh(r,"playbackData"),g.Q(m,jP(B.X,k,"playbackData"),2);x=m.C;if((J=x)==null?0:J.playerResponseJson)return m.return(JSON.parse(x.playerResponseJson));throw Error("No PlayerResponse found");})},OQ=function(B,y){B.api.h7("woffle",{mcte:y});
rg("missing current transfer entity.")},$l=function(B,y){var a,r,k;
return g.F(function(x){if(x.X==1)return g.Q(x,jP(B.X,g.Oh(y,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);a=x.C;return x.return((k=(r=a)==null?void 0:r.offlineModeType)!=null?k:void 0)})},CWK=function(B){return zea[B.transferState]!==void 0},giS=function(B,y){var a=zea[B.transferState],r=zea[y.transferState];
return a!==r?a-r:Number(B.enqueuedTimestampMs)-Number(y.enqueuedTimestampMs)},Zs=function(B,y){var a=this;
this.Pk=B;this.api=y;this.T=new g.ey;this.j=new g.JX;this.H6={ST:function(){return a.D.H6.ST()},
fY:function(){return a.T},
wSs:function(){return a.D},
bG:function(){return a.bG()},
uu:function(){return a.uu()},
TV:function(){return a.TV()},
k7:function(){return a.k7()},
ZY:function(){return a.ZY()},
mC:function(r){return a.mC(r)}};
this.D=new BDp(function(){return qOV(a)},function(){a.TV()},this.api.IL(),this.api.Z.bind(this.api));
this.C=new kl(this.api);yX0(this.D)},qOV=function(B){return g.F(function(y){B.api.Kh("onOrchestrationBecameLeader");
return g.Q(y,B.uu(),0)})},ReO=function(B){var y,a;
return g.F(function(r){if(r.X==1)return g.Q(r,vU(),2);if(r.X!=3){y=r.C;if(!y)return rg("PES is undefined"),r.return();B.X=new y_1(y,B.api,B.D,B.C);a=B.BY(y);return g.Q(r,DvK(y,a,B.D,B.C,B.Pk),3)}B.N=r.C;return g.Q(r,VfK(B),0)})},VfK=function(B){var y;
return g.F(function(a){switch(a.X){case 1:if(!B.X)return rg("transferManager is undefined"),a.return();if(B.X.C){a.dQ(2);break}return g.Q(a,Md(B.X),2);case 2:if(!B.Pk.Z("woffle_enable_main_downloads_library")){a.dQ(4);break}return g.Q(a,B.fS(),4);case 4:if(!B.Pk.Z("html5_offline_playback_position_sync")){a.dQ(6);break}return g.Q(a,B.mH(),7);case 7:return g.Q(a,B.mC(864E5),6);case 6:return g.Q(a,B.refreshAllStaleEntities(43200,!0),9);case 9:return g.Q(a,B.Ud(),10);case 10:if(!B.Pk.Z("html5_retry_downloads_for_expiration")){a.dQ(11);
break}return g.Q(a,B.ZY(),11);case 11:return B.K=g.mA(function(){B.refreshAllStaleEntities(43200,!0);B.Ud()},9E5),g.$e(g.I4(),function(){return B.k7()}),g.Q(a,vU(),13);
case 13:return y=a.C,g.Q(a,vfS(y),14);case 14:aHK(B.D),g.bJ(a)}})},ueo=function(){var B,y,a,r,k,x;
return g.F(function(J){switch(J.X){case 1:return g.Q(J,vU(),2);case 2:B=J.C;if(!B)return J.return([]);y=Date.now()/1E3;return g.Q(J,hn(B,"offlineVideoPolicy"),3);case 3:a=J.C,r=g.Y(a),k=r.next();case 4:if(k.done){J.dQ(6);break}x=k.value;if(!(x.expirationTimestamp&&Number(x.expirationTimestamp)<y)){J.dQ(5);break}x.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";x.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.Q(J,Uu(B,x,"offlineVideoPolicy"),5);
case 5:k=r.next();J.dQ(4);break;case 6:return J.return(a.map(function(m){return m.key}))}})},nA=function(B,y,a,r,k){var x,J,m;
return g.F(function(C){if(C.X==1)return g.Q(C,vU(),2);x=C.C;if(!x)return C.return([]);J=y.map(function(l){var c=g.Oh(l,a);c={actionType:r,entityKey:c,actionMetadata:Object.assign({},wkS(),k)};r!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(c.actionMetadata.priority=0);l=new qd(a,l,c);return Rn(l)});
m=YHV(x,J);yX0(B.D);return C.return(m)})},YOa=function(B,y,a,r){var k,x,J,m,C,l,c,w;
return g.F(function(E){switch(E.X){case 1:k=[],x=g.Y(y),J=x.next();case 2:if(J.done){E.dQ(4);break}m=J.value;if(m.upToDate||a&&!m.shouldAutoSyncMetadata||!m.playlistId){E.dQ(3);break}C={};switch(r){case "mainPlaylistEntity":l={nextAutoRefreshIntervalSeconds:m.checkInSeconds,autoSync:a};C={mainPlaylistEntityActionMetadata:l};break;case "musicPlaylist":c={autoSync:a},C={musicPlaylistEntityActionMetadata:c}}return g.Q(E,nA(B,[m.playlistId],r,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",C),6);case 6:(w=
E.C)&&k.push.apply(k,g.Ee(w));case 3:J=x.next();E.dQ(2);break;case 4:return E.return(k)}})},L20=function(B,y){var a;
return g.F(function(r){return y.length?(a=wkS(),g.tk(a,eT,{isEnqueuedForExpiredStreamUrlRefetch:!0}),B.api.h7("qrd",{v:y.length}),r.return(nA(B,y,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a))):r.return([])})},NG7=function(B,y,a){this.C=B;
this.Pk=y;this.D=a},p1V=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P;
return g.F(function(A){switch(A.X){case 1:return a=on(y),r=g.$J(y.entityKey),k=r.entityId,x=[],g.TU(A,2),g.Q(A,b$o(B,k),4);case 4:x=A.C;if(!(B.Pk.Z("woffle_enable_main_downloads_library")&&((J=x)==null?0:J.length))){A.dQ(5);break}return g.Q(A,t1K(B.C,[y.entityKey]),5);case 5:g.PE(A,3);break;case 2:return m=g.Sx(A),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.HL&&m.type==="QUOTA_EXCEEDED"?(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):rg("Playlist add error"),A.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,C,l));case 3:c=[];if(!B.Pk.Z("html5_offline_prevent_redownload_downloaded_video")){A.dQ(7);break}return g.Q(A,lHO(B.C,"mainVideoEntity",x),8);case 8:x=A.C;case 7:if((w=x)==null?0:w.length)for(E=g.Y(x),z=E.next();!z.done;z=E.next())if(q=z.value,L=q.offlineVideoData,b=void 0,(b=L)==null?0:b.videoId)S=void 0,P=Number(((S=y.actionMetadata)==null?void 0:S.priority)||
0)+1,c.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",L.videoId,"mainVideoEntity",P,dg,TGO(y,L,k)));return A.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,c))}})},PWY=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro,iJ,s7,E7,O7,yO,t,WQ,AK,r$,PC,N,a0,O3,xm,XO,n4,hr,j6,K_,T,u,p,G,X,lJ,I,v,e,FH,$W,mN,CS,Qr,NL,hd,ba,WC,tr,ui,Ar,FO,TY;
return g.F(function(HQ){switch(HQ.X){case 1:return a=on(y),r=y.entityKey,k=g.$J(r).entityId,x=[],J=!1,k==="!*$_ALL_ENTITIES_!*$"?(J=!0,g.Q(HQ,hn(B.C,"mainPlaylistEntity"),5)):g.Q(HQ,jP(B.C,r,"mainPlaylistEntity"),4);case 4:(m=HQ.C)&&x.push(m);HQ.dQ(3);break;case 5:x=HQ.C;case 3:if((C=x)==null||!C.length)return HQ.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));l=g.f(y.actionMetadata,tfV);w=(c=l)==null?void 0:c.nextAutoRefreshIntervalSeconds;z=(E=l)==null?void 0:E.autoSync;q=[];b=L=
!0;S=!1;if(!J&&z===!1){HQ.dQ(6);break}g.TU(HQ,7);return g.Q(HQ,M1Y(0,!!z,!0,x),9);case 9:q=HQ.C;g.PE(HQ,8);break;case 7:P=g.Sx(HQ);if(!(P instanceof Error&&P.message==="No data")){P instanceof Error&&P.message==="Empty response body"&&rg(P.message);HQ.dQ(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.Q(HQ,YjC(B.C,y,B.D,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.Q(HQ,RI0(k,B.C,y,B.D),8);case 8:if(!q.length||!J&&q[0].playlistId!==k)return HQ.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a));case 6:if(J){A=[];D=g.Y(q);for(M=D.next();!M.done;M=D.next())U=M.value,U.upToDate||z&&!U.shouldAutoSyncMetadata||!U.playlistId||(n={nextAutoRefreshIntervalSeconds:U.checkInSeconds,autoSync:z},A.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U.playlistId,"mainPlaylistEntity",0,dg,{mainPlaylistEntityActionMetadata:n})));return HQ.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,A))}q.length&&(xW=q[0],S=!!xW.upToDate,z&&(L=(C4=xW.shouldAutoSyncMetadata)!=null?C4:!0,b=(HE=xW.shouldAutoSyncVideos)!=
null?HE:!0,xW.checkInSeconds&&(w=xW.checkInSeconds)));if(S||!L)return HQ.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g$$=[];yr=x[0];if(!yr.downloadState){YW=void 0;HQ.dQ(15);break}return g.Q(HQ,jP(B.C,yr.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:YW=HQ.C;case 15:return ex=YW,ia=((BC=ex)==null?0:BC.addedTimestampMillis)?String(ex.addedTimestampMillis):void 0,g.TU(HQ,17),g.Q(HQ,b$o(B,k,ia,w),19);case 19:g$$=HQ.C;g.PE(HQ,18);break;case 17:Ro=g.Sx(HQ);if(!(Ro instanceof
Error&&Ro.message==="No data for playlist")){if(Ro instanceof Error&&Ro.message==="Empty response body for playlist")rg(Ro.message);else return iJ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",s7="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ro instanceof g.HL&&Ro.type==="QUOTA_EXCEEDED"&&(iJ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",s7="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),HQ.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,iJ,s7));
HQ.dQ(18);break}return g.Q(HQ,RI0(k,B.C,y,B.D),18);case 18:if(!b)return HQ.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));E7=[];O7=new Map;if((yO=g$$)==null?0:yO.length)for(t=g.Y(g$$),WQ=t.next();!WQ.done;WQ=t.next())AK=WQ.value,r$=AK.offlineVideoData,PC=void 0,((PC=r$)==null?0:PC.videoId)&&O7.set(r$.videoId,r$);N=new Map;a0=[];if((O3=yr)==null?0:(xm=O3.videos)==null?0:xm.length)for(XO=g.Y(yr.videos),n4=XO.next();!n4.done;n4=XO.next())if(hr=n4.value,j6=JSON.parse(g.$J(hr).entityId),
K_=j6.videoId)O7.has(K_)?(N.set(K_,O7.get(K_)),O7.delete(K_)):a0.push(K_);u=Number(((T=y.actionMetadata)==null?void 0:T.priority)||0)+1;p=g.Y(O7.entries());for(G=p.next();!G.done;G=p.next())X=G.value,lJ=g.Y(X),I=lJ.next().value,v=lJ.next().value,e=I,FH=v,E7.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e,"mainVideoEntity",u,dg,TGO(y,FH,k)));$W=g.Y(N.entries());for(mN=$W.next();!mN.done;mN=$W.next())CS=mN.value,Qr=g.Y(CS),NL=Qr.next().value,hd=Qr.next().value,ba=NL,WC=hd,E7.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
ba,"mainVideoEntity",u,dg,TGO(y,WC,k)));tr=g.Y(a0);for(ui=tr.next();!ui.done;ui=tr.next())Ar=ui.value,FO={playlistId:k},TY={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:FO},E7.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Ar,"mainVideoEntity",0,dg,TY));return HQ.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,E7))}})},SOI=function(B,y){var a,r,k,x;
return g.F(function(J){switch(J.X){case 1:return a=on(y),g.TU(J,2),r=g.$J(y.entityKey).entityId,r==="!*$_ALL_ENTITIES_!*$"?g.Q(J,YjC(B.C,y,B.D,(k=y.actionMetadata)==null?void 0:(x=k.offlineLoggingData)==null?void 0:x.offlineDeleteReason),5):g.Q(J,RI0(r,B.C,y,B.D),6);case 6:if(!B.Pk.Z("woffle_enable_main_downloads_library")){J.dQ(5);break}return g.Q(J,PX7(B.C,y.entityKey),5);case 5:g.PE(J,3);break;case 2:return g.Sx(J),J.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},b$o=function(B,y,a,r){var k,x,J,m,C,l,c;
return g.F(function(w){switch(w.X){case 1:return g.Q(w,XkY([y]),2);case 2:return k=w.C,g.Q(w,QQK(B,k[0],a,r),3);case 3:return x=w.C,J=x.mainPlaylistEntity,m=x.ABb,l=qjO(J,(C=m)==null?void 0:C.avatar),g.TU(w,4),g.Q(w,Yl(l),6);case 6:g.PE(w,5);break;case 4:c=g.Sx(w),c instanceof Error&&c.message==="Failed to fetch"&&rg(c.message);case 5:return w.return(k[0].videos)}})},QQK=function(B,y,a,r){var k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D;
return g.F(function(M){switch(M.X){case 1:k=Date.now().toString();a||(a=k);x=y.videos;J=y.playlistId;m=[];C=[];if(x)for(l=g.Y(x),c=l.next();!c.done;c=l.next()){w=c.value;E=w.offlineVideoData;if(!E||!E.videoId)throw rg("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");z=E.videoId;q={videoId:z,playlistId:J};L={id:g.Oh(JSON.stringify(q),"mainPlaylistVideoEntity"),video:g.Oh(z,"mainVideoEntity")};m.push(L);C.push(L.id)}S={key:g.Oh(J,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:a,lastSyncedTimestampMillis:k};P={key:g.Oh(J,"mainPlaylistEntity"),playlistId:J,videos:C,title:y.title,thumbnailStyleData:A_1(y),visibility:F2C(y),downloadState:S.key};y.channel&&(A=y.channel.offlineChannelData,b=GTu(g.Oh(J,"ytMainChannelEntity"),A),P.channelOwner=b.id);((D=P)==null?0:D.entityMetadata)?(P.entityMetadata.offlineLastModifiedTimestampSeconds=y.lastModifiedTimestamp,r&&(P.entityMetadata.nextAutoRefreshIntervalSeconds=String(r))):P&&(P.entityMetadata={nextAutoRefreshIntervalSeconds:r?
String(r):void 0,offlineLastModifiedTimestampSeconds:y.lastModifiedTimestamp});g.TU(M,2);return g.Q(M,dw(B.C,{mode:"readwrite",Ei:!0},function(U){var n=Ou(U,P,"mainPlaylistEntity"),xW=Ou(U,S,"mainPlaylistDownloadStateEntity");n=[n,xW];xW=g.Y(m);for(var C4=xW.next();!C4.done;C4=xW.next())n.push(Ou(U,C4.value,"mainPlaylistVideoEntity"));b&&n.push(Ou(U,b,"ytMainChannelEntity"));return g.wj.all(n)}),4);
case 4:g.PE(M,3);break;case 2:throw g.Sx(M),rg("PES failure for playlist"),Error("PES failure for playlist");case 3:return M.return({mainPlaylistEntity:P,ABb:b,uGb:m})}})},GTu=function(B,y){return{id:B,
channelId:y.channelId,title:y.title,avatar:y.thumbnail}},A_1=function(B){var y=[],a=B.videos;
a&&a.length>0&&y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:a[0].offlineVideoData.thumbnail}}});if((B=B.additionalMetadadatas)&&B.length>0)for(B=g.Y(B),a=B.next();!a.done;a=B.next()){var r=a.value.offlineBundleItemPlaylistData,k=void 0;a=(k=r)==null?void 0:k.style;k=void 0;r={collageThumbnail:{coverThumbnail:(k=r)==null?void 0:k.coverThumbnail}};switch(a){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:r});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:r});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:r});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:r})}}return y},F2C=function(B){switch(B.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},TGO=function(B,y,a){y={offlineVideoData:y,
playlistId:a};if(B=g.f(B.actionMetadata,tfV))y.maximumDownloadQuality=B.maximumDownloadQuality;return{mainVideoEntityActionMetadata:y}},eeo=function(B,y,a){this.C=B;
this.Pk=y;this.D=a},K2K=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q;
return g.F(function(L){switch(L.X){case 1:return a=on(y),r=g.$J(y.entityKey),k=r.entityId,x=g.f(y.actionMetadata,UQ),m=!((J=x)==null?0:J.playlistId),g.TU(L,2),g.Q(L,D5K(B,k,void 0,(C=x)==null?void 0:C.offlineVideoData,m),4);case 4:g.PE(L,3);break;case 2:return l=g.Sx(L),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.HL&&l.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
L.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,c,w));case 3:E=1;E=Number(((z=y.actionMetadata)==null?void 0:z.priority)||0)+1;var b=(b=g.f(y.actionMetadata,UQ))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;q=FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",E,W27,b);return L.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,[q]))}})},i$u=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P;
return g.F(function(A){switch(A.X){case 1:return a=on(y),r=g.$J(y.entityKey),k=r.entityId,g.Q(A,jP(B.C,y.entityKey,"mainVideoEntity"),2);case 2:x=A.C;if(!x){J=void 0;A.dQ(3);break}return g.Q(A,jP(B.C,x.downloadState,"mainVideoDownloadStateEntity"),4);case 4:J=A.C;case 3:m=J;if(!x||!m)return A.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.TU(A,5);return g.Q(A,D5K(B,k,m.addedTimestampMillis,(l=g.f(y.actionMetadata,UQ))==null?void 0:l.offlineVideoData),7);case 7:c=1;c=Number(((w=
y.actionMetadata)==null?void 0:w.priority)||0)+1;C=FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",c,W27);g.PE(A,6);break;case 5:E=g.Sx(A);if(!(E instanceof Error&&E.message==="No data")){if(E instanceof Error&&E.message==="Empty response body")rg(E.message);else return z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.HL&&E.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),A.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,z,q));A.dQ(6);break}return g.Q(A,bO(B.C,k),9);case 9:L=A.C;b=g.f(y.actionMetadata,UQ);if(P=(S=b)==null?void 0:S.playlistId)L.playlistId=P;L.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.Q(A,LA(k,B.C,y,B.D,L),6);case 6:return A.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,C?[C]:void 0))}})},X1V=function(B,y){var a,r,k,x,J,m,C,l,c,w;
return g.F(function(E){switch(E.X){case 1:return a=on(y),g.TU(E,2),r=g.$J(y.entityKey).entityId,r==="!*$_ALL_ENTITIES_!*$"?g.Q(E,YjC(B.C,y,B.D,(c=y.actionMetadata)==null?void 0:(w=c.offlineLoggingData)==null?void 0:w.offlineDeleteReason),5):g.Q(E,bO(B.C,r),6);case 6:k=E.C;x=g.f(y.actionMetadata,UQ);if(m=(J=x)==null?void 0:J.playlistId)k.playlistId=m;k.offlineDeleteReason=(C=y.actionMetadata)==null?void 0:(l=C.offlineLoggingData)==null?void 0:l.offlineDeleteReason;return g.Q(E,LA(r,B.C,y,B.D,k),7);
case 7:if(!B.Pk.Z("woffle_enable_main_downloads_library")){E.dQ(5);break}return g.Q(E,PX7(B.C,y.entityKey),5);case 5:g.PE(E,3);break;case 2:return g.Sx(E),E.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},D5K=function(B,y,a,r,k){var x,J,m,C,l,c;
return g.F(function(w){switch(w.X){case 1:if(x=r){w.dQ(2);break}return g.Q(w,iho([y]),3);case 3:J=w.C,x=J[0];case 2:return g.Q(w,fnp(B,x,a,k),4);case 4:m=w.C;C=m.mainVideoEntity;l=m.channelEntity;g.TU(w,5);var E=zb(C.thumbnail),z=zb(l.avatar);return g.Q(w,Yl(E.concat(z)),7);case 7:g.PE(w,0);break;case 5:c=g.Sx(w),c instanceof Error&&c.message==="Failed to fetch"&&rg(c.message),g.bJ(w)}})},fnp=function(B,y,a,r){var k,x,J,m,C,l,c,w,E,z,q,L,b;
return g.F(function(S){switch(S.X){case 1:a||(a=Date.now().toString());x=(k=y.channel)==null?void 0:k.offlineChannelData;J={id:g.Oh(y.videoId,"ytMainChannelEntity"),channelId:x.channelId,title:x.title,avatar:x.thumbnail};m={key:g.Oh(y.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Oh(y.videoId,"playbackData"),addedTimestampMillis:a,videoDownloadContextEntity:g.Oh(y.videoId,"videoDownloadContextEntity")};C={key:g.Oh(y.videoId,"videoPlaybackPositionEntity"),videoId:y.videoId,lastPlaybackPositionSeconds:"0"};
B.Pk.Z("html5_offline_playback_position_sync")&&(l={playbackPosition:C.key});c=g.Oh(y.videoId,"mainVideoEntity");w={key:c,videoId:y.videoId,title:y.title,thumbnail:y.thumbnail,localizedStrings:{viewCount:y.shortViewCountText},userState:l,lengthSeconds:y.lengthSeconds?Number(y.lengthSeconds):void 0,publishedTimestampMillis:y.publishedTimestamp?(Number(y.publishedTimestamp)*1E3).toString():void 0,formattedDescription:y.description,owner:J.id,downloadState:m.key};if(!B.Pk.Z("woffle_enable_main_downloads_library")||
!r){S.dQ(2);break}return g.Q(S,pkO(B.C,[c]),3);case 3:if(q=S.C)E=q.mainDownloadsLibraryEntity,z=q.mainDownloadsListEntity;case 2:return b=gk0,L={key:g.Oh(y.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.tk(m,b,L),g.Q(S,dw(B.C,{mode:"readwrite",Ei:!0},function(P){var A=Ou(P,J,"ytMainChannelEntity"),D=Ou(P,m,"mainVideoDownloadStateEntity"),M=Ou(P,w,"mainVideoEntity");A=[A,D,M];B.Pk.Z("html5_offline_playback_position_sync")&&(D=Ou(P,C,"videoPlaybackPositionEntity"),
A.push(D));E&&(D=Ou(P,E,"mainDownloadsLibraryEntity"),A.push(D));z&&(D=Ou(P,z,"mainDownloadsListEntity"),A.push(D));L&&(P=Ou(P,L,"downloadStatusEntity"),A.push(P));return g.wj.all(A)}),4);
case 4:return S.return({mainVideoEntity:w,channelEntity:J})}})},MfV=function(B,y,a){this.C=B;
this.Pk=y;this.D=a},O$V=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr;
return g.F(function(YW){switch(YW.X){case 1:return a=on(y),r=[],g.Q(YW,Kd.getInstance(),2);case 2:k=YW.C;if(!k){YW.dQ(3);break}return g.Q(YW,k.get("sdois"),4);case 4:return x=YW.C,g.Q(YW,(m=k)==null?void 0:m.get("lmqf"),5);case 5:J=YW.C;case 3:g.TU(YW,6);if(x===void 0)throw Error("prefStorage or opt-in state is undefined");C=[];if(x){YW.dQ(8);break}return g.Q(YW,TDY(B.C),9);case 9:C=YW.C,C.reverse();case 8:if(!C.length){YW.dQ(10);break}l=g.Y(C);c=l.next();case 11:if(c.done){YW.dQ(10);break}w=c.value;
if(!w){YW.dQ(12);break}E=g.$J(w).entityId;return g.Q(YW,bO(B.C,E),14);case 14:return z=YW.C,z.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.Q(YW,LA(E,B.C,{entityKey:w,actionType:y.actionType},B.D,z),12);case 12:c=l.next();YW.dQ(11);break;case 10:return g.Q(YW,Oh1(x,(q=J)!=null?q:"SD"),16);case 16:return L=YW.C,g.Q(YW,LM7(L),17);case 17:b=bhY(L);if(!B.Pk.Z("woffle_enable_main_downloads_library")){YW.dQ(18);break}if(x){YW.dQ(19);break}return g.Q(YW,PX7(B.C,g.iF),19);case 19:return g.Q(YW,
t1K(B.C,[g.iF]),18);case 18:if((S=b)==null?0:S.length)for(P=g.Y(b),A=P.next();!A.done;A=P.next())if(M=D=A.value,U=M.actionType,n=M.entityKey,xW=M.actionMetadata,U&&n&&xW&&!g.f(xW,$51)){U==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(xW.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(C4=g.f(D.actionMetadata,UQ))C4.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",D.actionMetadata=Object.assign({},D.actionMetadata,{mainVideoEntityActionMetadata:C4});r.push(D)}g.PE(YW,
7);break;case 6:return HE=g.Sx(YW),g$$="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",yr="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",HE instanceof g.HL&&HE.type==="QUOTA_EXCEEDED"&&(g$$="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",yr="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),YW.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,g$$,yr));case 7:return YW.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,r))}})},Ino=function(){Zs.apply(this,
arguments);
this.U="mainVideoEntity"},Z$K=function(B,y,a){y=y===void 0?43200:y;
a=a===void 0?!0:a;var r=r===void 0?!1:r;var k,x,J;return g.F(function(m){switch(m.X){case 1:if(!B.T.qa())return m.return([]);k=[];g.TU(m,2);return g.Q(m,M1Y(y,a,r),4);case 4:k=m.C;g.PE(m,3);break;case 2:x=g.Sx(m),x instanceof Error&&x.message==="No data"||x instanceof Error&&x.message==="Empty response body"&&rg(x.message);case 3:return J=YOa(B,k,a,"mainPlaylistEntity"),m.return(J)}})},niS=function(B,y,a,r){r=r===void 0?!1:r;
var k,x,J,m,C,l,c,w,E,z,q,L,b,S,P;return g.F(function(A){switch(A.X){case 1:return k=[],g.Q(A,$1o(),2);case 2:return(x=A.C)||r?g.Q(A,IHK(y,a),3):A.return([]);case 3:J=A.C;if((m=J)==null||!m.length)return A.return([]);C={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};l=g.Y(J);c=l.next();case 4:if(c.done){A.dQ(6);break}E=w=c.value;z=E.actionType;q=E.entityKey;L=E.actionMetadata;if(!(z&&q&&L)||g.f(L,$51)){A.dQ(5);break}z==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(L.offlineLoggingData=
C);b=g.$J(q);S=b.entityId;return g.Q(A,nA(B,[S],"mainVideoEntity",z,L),8);case 8:P=A.C,k=k.concat(P);case 5:c=l.next();A.dQ(4);break;case 6:return A.return(k)}})},d57=function(B,y){this.C=B;
this.D=y},jQY=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S;
return g.F(function(P){switch(P.X){case 1:return a=on(y),r=g.$J(y.entityKey),k=r.entityId,x=[],g.TU(P,2),g.Q(P,U5C(B,k),4);case 4:x=P.C;if((J=x)==null||!J.length){P.dQ(5);break}return g.Q(P,GRo(B.C,y.entityKey),5);case 5:g.PE(P,3);break;case 2:return m=g.Sx(P),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.HL&&m.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
P.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,C,l));case 3:return c=[],g.Q(P,lHO(B.C,"musicTrack",x),7);case 7:x=P.C;if(x.length)for(w=g.Y(x),E=w.next();!E.done;E=w.next())if(z=E.value,q=z.offlineVideoData,L=void 0,(L=q)==null?0:L.videoId)b=void 0,S=Number(((b=y.actionMetadata)==null?void 0:b.priority)||0)+1,c.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q.videoId,"musicTrack",S,jT,PW(y,q,k)));return P.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,c))}})},
sQ0=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro,iJ,s7,E7,O7,yO,t,WQ,AK,r$,PC,N,a0,O3,xm,XO,n4,hr,j6,K_,T,u,p,G,X,lJ,I,v;
return g.F(function(e){switch(e.X){case 1:return a=on(y),r=y.entityKey,k=g.$J(r).entityId,x=[],J=!1,k==="!*$_ALL_ENTITIES_!*$"?(J=!0,g.Q(e,hn(B.C,"musicAlbumRelease"),5)):g.Q(e,jP(B.C,r,"musicAlbumRelease"),4);case 4:(m=e.C)&&x.push(m);e.dQ(3);break;case 5:x=e.C;case 3:if((C=x)==null||!C.length)return e.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));if(J){l=[];c=g.Y(x);for(w=c.next();!w.done;w=c.next())E=w.value,z=g.$J(E.id).entityId,l.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
z,"musicAlbumRelease",0,jT));return e.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,l))}q=[];L=x[0];b=void 0;if(!L.downloadMetadata){e.dQ(6);break}return g.Q(e,jP(B.C,L.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:S=e.C,b=Number((A=(P=S)==null?void 0:P.addedTimestampMillis)!=null?A:"0")/1E3;case 6:return g.TU(e,8),g.Q(e,U5C(B,k,(D=b)==null?void 0:D.toString()),10);case 10:q=e.C;g.PE(e,9);break;case 8:M=g.Sx(e);if(!(M instanceof Error&&M.message==="No data")){if(M instanceof
Error&&M.message==="Empty response body")rg(M.message);else return U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.HL&&M.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),e.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,U,n));e.dQ(9);break}return g.Q(e,pA(k,"musicAlbumRelease",B.C,y,B.D),9);case 9:xW=[];C4=new Map;
if((HE=q)==null?0:HE.length)for(g$$=g.Y(q),yr=g$$.next();!yr.done;yr=g$$.next())YW=yr.value,ex=YW.offlineVideoData,BC=void 0,((BC=ex)==null?0:BC.videoId)&&C4.set(ex.videoId,ex);ia=new Map;Ro=[];if((iJ=L)==null?0:(s7=iJ.tracks)==null?0:s7.length)for(E7=g.Y(L.tracks),O7=E7.next();!O7.done;O7=E7.next())if(yO=O7.value,t=g.$J(yO).entityId)C4.has(t)?(ia.set(t,C4.get(t)),C4.delete(t)):Ro.push(t);AK=Number(((WQ=y.actionMetadata)==null?void 0:WQ.priority)||0)+1;r$=g.Y(C4.entries());for(PC=r$.next();!PC.done;PC=
r$.next())N=PC.value,a0=g.Y(N),O3=a0.next().value,xm=a0.next().value,XO=O3,n4=xm,xW.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",XO,"musicTrack",AK,jT,PW(y,n4)));hr=g.Y(ia.entries());for(j6=hr.next();!j6.done;j6=hr.next())K_=j6.value,T=g.Y(K_),u=T.next().value,p=T.next().value,G=u,X=p,xW.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",G,"musicTrack",AK,jT,PW(y,X)));lJ=g.Y(Ro);for(I=lJ.next();!I.done;I=lJ.next())v=I.value,xW.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",v,"musicTrack",
0,jT));return e.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,xW))}})},heo=function(B,y){var a,r;
return g.F(function(k){switch(k.X){case 1:return a=on(y),g.TU(k,2),r=g.$J(y.entityKey).entityId,r==="!*$_ALL_ENTITIES_!*$"?g.Q(k,tF(B.C,y,B.D),5):g.Q(k,pA(r,"musicAlbumRelease",B.C,y,B.D),6);case 6:return g.Q(k,eIS(B.C,y.entityKey),5);case 5:g.PE(k,3);break;case 2:return g.Sx(k),k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},U5C=function(B,y,a){var r,k,x;
return g.F(function(J){switch(J.X){case 1:return g.Q(J,XkY([y]),2);case 2:return r=J.C,g.Q(J,vi1(B,r[0],a),3);case 3:return k=J.C,x=zb(k.thumbnailDetails),g.Q(J,Yl(x),4);case 4:return J.return(r[0].videos)}})},vi1=function(B,y,a){var r,k,x,J,m,C,l,c,w,E,z,q,L,b;
return g.F(function(S){if(S.X==1){r=y.additionalMetadadatas;k=void 0;if(r&&r.length>0)for(x=g.Y(r),J=x.next();!J.done;J=x.next())if(m=J.value,m.offlineMusicPlaylistData){k=m.offlineMusicPlaylistData;break}C=y.playlistId;l=D1S(y);c=l.z5;w=l.Ey;E=a?(Number(a)*1E3).toString():Date.now().toString();z=y.lastModifiedTimestamp?(Number(y.lastModifiedTimestamp)*1E3).toString():"0";q={id:g.Oh(C,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:w,lastModifiedTimestampMillis:z,addedTimestampMillis:E,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};L={id:g.Oh(C,"musicAlbumRelease"),title:y.title,audioPlaylistId:C,trackCount:y.totalVideoCount,tracks:c,downloadMetadata:q.id};k&&(L.thumbnailDetails=(b=k.albumHqThumbnail)!=null?b:k.albumArtistThumbnail,L.artistDisplayName=k.albumArtistDisplayName,L.releaseDate=k.albumReleaseDate,L.contentRating={explicitType:k.albumReleaseExplicitType},L.releaseType=k.albumReleaseType);return g.Q(S,dw(B.C,{mode:"readwrite",Ei:!0},function(P){var A=Ou(P,L,"musicAlbumRelease");
P=Ou(P,q,"musicAlbumReleaseDownloadMetadataEntity");return g.wj.all([A,P])}),2)}return S.return(L)})},BnI=function(B,y){this.C=B;
this.D=y},ara=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S;
return g.F(function(P){switch(P.X){case 1:return a=on(y),r=g.$J(y.entityKey),k=r.entityId,x=[],g.TU(P,2),g.Q(P,yDS(B,k),4);case 4:x=P.C;if((J=x)==null||!J.length){P.dQ(5);break}return g.Q(P,GRo(B.C,y.entityKey),5);case 5:g.PE(P,3);break;case 2:return m=g.Sx(P),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.HL&&m.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
P.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,C,l));case 3:return c=[],g.Q(P,lHO(B.C,"musicTrack",x),7);case 7:x=P.C;if(x.length)for(w=g.Y(x),E=w.next();!E.done;E=w.next())if(z=E.value,q=z.offlineVideoData,L=void 0,(L=q)==null?0:L.videoId)b=void 0,S=Number(((b=y.actionMetadata)==null?void 0:b.priority)||0)+1,c.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q.videoId,"musicTrack",S,sQ,PW(y,q,k)));return P.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,c))}})},
rDC=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro,iJ,s7,E7,O7,yO,t,WQ,AK,r$,PC,N,a0,O3,xm,XO,n4,hr,j6,K_,T,u,p,G,X,lJ,I,v,e,FH,$W,mN,CS,Qr,NL,hd,ba,WC,tr,ui;
return g.F(function(Ar){switch(Ar.X){case 1:return a=on(y),r=y.entityKey,k=g.$J(r).entityId,x=[],J=!1,k==="!*$_ALL_ENTITIES_!*$"?(J=!0,g.Q(Ar,hn(B.C,"musicPlaylist"),5)):g.Q(Ar,jP(B.C,r,"musicPlaylist"),4);case 4:(m=Ar.C)&&x.push(m);Ar.dQ(3);break;case 5:x=Ar.C;case 3:if((C=x)==null||!C.length)return Ar.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));l=g.f(y.actionMetadata,WMC);w=(c=l)==null?void 0:c.autoSync;E=[];q=z=!0;L=!1;b=void 0;if(!J&&w===!1){Ar.dQ(6);break}g.TU(Ar,7);return g.Q(Ar,
ZhS(0,!!w,!0,x),9);case 9:E=Ar.C;g.PE(Ar,8);break;case 7:S=g.Sx(Ar);if(!(S instanceof Error&&S.message==="No data")){S instanceof Error&&S.message==="Empty response body"&&rg(S.message);Ar.dQ(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.Q(Ar,tF(B.C,y,B.D),8):g.Q(Ar,pA(k,"musicPlaylist",B.C,y,B.D),8);case 8:if(!E.length||!J&&E[0].playlistId!==k)return Ar.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));case 6:if(J){P=[];A=g.Y(E);for(D=A.next();!D.done;D=A.next())M=D.value,M.upToDate||
w&&!M.shouldAutoSyncMetadata||!M.playlistId||(U={autoSync:w},P.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M.playlistId,"musicPlaylist",0,sQ,{musicPlaylistEntityActionMetadata:U})));return Ar.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,P))}E.length&&(n=E[0],L=!!n.upToDate,w&&(z=(xW=n.shouldAutoSyncMetadata)!=null?xW:!0,q=(C4=n.shouldAutoSyncVideos)!=null?C4:!0,n.checkInSeconds&&(b=n.checkInSeconds)));if(L||!z)return Ar.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a));HE=[];g$$=x[0];yr=void 0;if(!g$$.downloadMetadata){Ar.dQ(15);break}return g.Q(Ar,jP(B.C,g$$.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:YW=Ar.C,yr=Number((BC=(ex=YW)==null?void 0:ex.addedTimestampMillis)!=null?BC:"0")/1E3;case 15:return g.TU(Ar,17),g.Q(Ar,yDS(B,k,(ia=yr)==null?void 0:ia.toString(),b),19);case 19:HE=Ar.C;g.PE(Ar,18);break;case 17:Ro=g.Sx(Ar);if(!(Ro instanceof Error&&Ro.message==="No data")){if(Ro instanceof Error&&Ro.message==="Empty response body")rg(Ro.message);
else return iJ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",s7="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Ro instanceof g.HL&&Ro.type==="QUOTA_EXCEEDED"&&(iJ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",s7="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ar.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,iJ,s7));Ar.dQ(18);break}return g.Q(Ar,pA(k,"musicPlaylist",B.C,y,B.D),18);case 18:if(!q)return Ar.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a));E7=[];O7=new Map;if((yO=HE)==null?0:yO.length)for(t=g.Y(HE),WQ=t.next();!WQ.done;WQ=t.next())AK=WQ.value,r$=AK.offlineVideoData,PC=void 0,((PC=r$)==null?0:PC.videoId)&&O7.set(r$.videoId,r$);N=new Map;a0=[];if((O3=g$$)==null?0:(xm=O3.tracks)==null?0:xm.length)for(XO=g.Y(g$$.tracks),n4=XO.next();!n4.done;n4=XO.next())if(hr=n4.value,j6=g.$J(hr).entityId)O7.has(j6)?(N.set(j6,O7.get(j6)),O7.delete(j6)):a0.push(j6);T=Number(((K_=y.actionMetadata)==null?void 0:K_.priority)||0)+1;u=g.Y(O7.entries());
for(p=u.next();!p.done;p=u.next())G=p.value,X=g.Y(G),lJ=X.next().value,I=X.next().value,v=lJ,e=I,E7.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v,"musicTrack",T,sQ,PW(y,e)));FH=g.Y(N.entries());for($W=FH.next();!$W.done;$W=FH.next())mN=$W.value,CS=g.Y(mN),Qr=CS.next().value,NL=CS.next().value,hd=Qr,ba=NL,E7.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",hd,"musicTrack",T,sQ,PW(y,ba)));WC=g.Y(a0);for(tr=WC.next();!tr.done;tr=WC.next())ui=tr.value,E7.push(FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
ui,"musicTrack",0,sQ));return Ar.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,E7))}})},kyK=function(B,y){var a,r;
return g.F(function(k){switch(k.X){case 1:return a=on(y),g.TU(k,2),r=g.$J(y.entityKey).entityId,r==="!*$_ALL_ENTITIES_!*$"?g.Q(k,tF(B.C,y,B.D),5):g.Q(k,pA(r,"musicPlaylist",B.C,y,B.D),6);case 6:return g.Q(k,eIS(B.C,y.entityKey),5);case 5:g.PE(k,3);break;case 2:return g.Sx(k),k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},yDS=function(B,y,a,r){var k,x,J;
return g.F(function(m){switch(m.X){case 1:return g.Q(m,XkY([y]),2);case 2:return k=m.C,g.Q(m,xz1(B,k[0],a,r),3);case 3:return x=m.C,J=zb(x.thumbnailDetails),g.Q(m,Yl(J),4);case 4:return m.return(k[0].videos)}})},xz1=function(B,y,a,r){var k,x,J,m,C,l,c,w,E;
return g.F(function(z){return z.X==1?(k=y.playlistId,x=D1S(y),J=x.z5,m=x.Ey,C=a?(Number(a)*1E3).toString():Date.now().toString(),l=y.lastModifiedTimestamp?(Number(y.lastModifiedTimestamp)*1E3).toString():"0",c={id:g.Oh(k,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:m,lastModifiedTimestampMillis:l,addedTimestampMillis:C,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},w={id:g.Oh(k,"musicPlaylist"),title:y.title,playlistId:k,thumbnailDetails:y.thumbnail,visibility:JDK(y),trackCount:y.totalVideoCount,
tracks:J,downloadMetadata:c.id},r&&(((E=w)==null?0:E.entityMetadata)?w.entityMetadata.nextAutoRefreshIntervalSeconds=String(r):w&&(w.entityMetadata={nextAutoRefreshIntervalSeconds:String(r)})),g.Q(z,dw(B.C,{mode:"readwrite",Ei:!0},function(q){var L=Ou(q,w,"musicPlaylist");q=Ou(q,c,"musicPlaylistDownloadMetadataEntity");return g.wj.all([L,q])}),2)):z.return(w)})},JDK=function(B){switch(B.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},H6S=function(B,y){this.C=B;
this.D=y},gQ7=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q;
return g.F(function(L){switch(L.X){case 1:return a=on(y),r=g.$J(y.entityKey),k=r.entityId,x=g.f(y.actionMetadata,mzY),g.TU(L,2),g.Q(L,oQI(B,k,void 0,(J=x)==null?void 0:J.track,(m=x)==null?void 0:m.albumRelease),4);case 4:if((C=x)==null?0:C.playlistId){L.dQ(5);break}return g.Q(L,GRo(B.C,y.entityKey),5);case 5:g.PE(L,3);break;case 2:return l=g.Sx(L),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.HL&&l.type==="QUOTA_EXCEEDED"&&
(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,c,w));case 3:z=Number(((E=y.actionMetadata)==null?void 0:E.priority)||0)+1;var b=(b=g.f(y.actionMetadata,mzY))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;q=FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",z,CoK,b);return L.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a,[q]))}})},lrI=function(B,y){var a,r,k,x,J,m,C,l,c,w,E,z,q,L,b;
return g.F(function(S){switch(S.X){case 1:return a=on(y),r=g.$J(y.entityKey),k=r.entityId,g.Q(S,jP(B.C,y.entityKey,"musicTrack"),2);case 2:x=S.C;if(!x){J=void 0;S.dQ(3);break}return g.Q(S,jP(B.C,x.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:J=S.C;case 3:m=J;if(!x||!m)return S.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));l=g.f(y.actionMetadata,mzY);g.TU(S,5);return g.Q(S,oQI(B,k,m.addedTimestampMillis,(c=l)==null?void 0:c.track,(w=l)==null?void 0:w.albumRelease),
7);case 7:z=Number(((E=y.actionMetadata)==null?void 0:E.priority)||0)+1;C=FP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",z,CoK);g.PE(S,6);break;case 5:q=g.Sx(S);if(!(q instanceof Error&&q.message==="No data")){if(q instanceof Error&&q.message==="Empty response body")rg(q.message);else return L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.HL&&q.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,L,b));S.dQ(6);break}return g.Q(S,Tb(k,B.C,y,B.D),6);case 6:return S.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,C?[C]:void 0))}})},cD7=function(B,y){var a,r;
return g.F(function(k){switch(k.X){case 1:return a=on(y),g.TU(k,2),r=g.$J(y.entityKey).entityId,r==="!*$_ALL_ENTITIES_!*$"?g.Q(k,tF(B.C,y,B.D),5):g.Q(k,Tb(r,B.C,y,B.D),6);case 6:return g.Q(k,eIS(B.C,y.entityKey),5);case 5:g.PE(k,3);break;case 2:return g.Sx(k),k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new Gb("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},oQI=function(B,y,a,r,k){var x,J,m,C,l,c;
return g.F(function(w){switch(w.X){case 1:if(x=r){w.dQ(2);break}return g.Q(w,iho([y]),3);case 3:J=w.C,m=J[0],x=FM7(m);case 2:return g.Q(w,wX0(B,x,y,k,a),4);case 4:C=w.C;l=C.musicTrackEntity;c=C.nN;var E=zb(l.thumbnailDetails),z=[];c&&(z=zb(c.thumbnailDetails));return g.Q(w,Yl(E.concat(z)),0)}})},wX0=function(B,y,a,r,k){var x;
return g.F(function(J){return J.X==1?(k||(k=Date.now().toString()),x={id:g.Oh(a,"musicTrackDownloadMetadataEntity"),playbackData:g.Oh(a,"playbackData"),addedTimestampMillis:k,videoDownloadContextEntity:g.Oh(a,"videoDownloadContextEntity")},r&&(y.albumRelease=r.id),g.Q(J,dw(B.C,{mode:"readwrite",Ei:!0},function(m){var C=[],l=Ou(m,x,"musicTrackDownloadMetadataEntity");C.push(l);l=Ou(m,y,"musicTrack");C.push(l);r&&(m=Ou(m,r,"musicAlbumRelease"),C.push(m));return g.wj.all(C)}),2)):J.X!=3?g.Q(J,cW(a,"musicTrackDownloadMetadataEntity",
B.C,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):J.return({musicTrackEntity:y,
nN:r})})},hF=function(){Zs.apply(this,arguments);
this.U="musicTrack"},EQ0=function(B,y,a){y=y===void 0?43200:y;
a=a===void 0?!0:a;var r=r===void 0?!1:r;var k,x;return g.F(function(J){switch(J.X){case 1:if(!B.T.qa())return J.return([]);k=[];g.TU(J,2);return g.Q(J,ZhS(y,a,r),4);case 4:k=J.C;g.PE(J,3);break;case 2:g.Sx(J);case 3:return x=YOa(B,k,a,"musicPlaylist"),J.return(x)}})},zsY=function(){g.N8.apply(this,arguments);
var B=this;this.events=new g.qO(this);this.Pk=this.player.Y();this.H6={yJ_:function(){return B.C},
l$:function(){return B.l$()},
KI:function(y){return B.KI(y)}}},qvo=function(B){var y;
B=g.f((y=B.getWatchNextResponse())==null?void 0:y.currentVideoEndpoint,g.gk);if(B==null?0:B.playlistId)var a=B.playlistId;return a},VcY=function(B,y){var a,r,k,x;
return g.F(function(J){if(J.X==1){a=y.clientPlaybackNonce;r={cpn:a,offlineSourceVisualElement:g.Cj(y.vk||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};y.X&&(r.videoFmt=Number(y.X.itag));y.J&&(r.audioFmt=Number(y.J.itag));if((k=qvo(y))&&y.videoId){var m=y.videoId;m=k!=="PPSV"?Promise.resolve(!1):B.C.QH(m);J=g.Q(J,m,3)}else J=J.dQ(2);return J}J.X!=2&&(x=J.C)&&(r.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");B.X=a;g.BL("offlinePlaybackStarted",r);g.bJ(J)})};
g.GZ.prototype.hP=g.kW(45,function(B){return this.app.hP(B)});
g.Rx.prototype.hP=g.kW(44,function(B){return g.F4U(this,9,B)});
g.R(DB,eP);g.Jr.Object.defineProperties(DB.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.C.entityMetadata},
set:function(B){this.C.entityMetadata=B}}});
g.R(mCV,DB);mCV.prototype.X=function(){return[]};
g.R(otS,DB);otS.prototype.X=function(){return[]};
g.R(ClY,DB);ClY.prototype.X=function(){return[]};
g.R(gtp,DB);gtp.prototype.X=function(){return[]};
g.R(l8S,DB);l8S.prototype.X=function(){var B=[];this.C.alternateChannel&&B.push(this.C.alternateChannel);this.C.alternateChannelList&&B.push.apply(B,g.Ee(this.C.alternateChannelList));this.C.oneofChannelEntity&&B.push(this.C.oneofChannelEntity);return[].concat(g.Ee(new Set(B)))};
g.R(caS,DB);caS.prototype.X=function(){var B=[];this.C.entryCollection&&B.push(this.C.entryCollection);return[].concat(g.Ee(new Set(B)))};
g.R(wGY,eP);wGY.prototype.X=function(){var B=[];this.C.video&&B.push(this.C.video);return[].concat(g.Ee(new Set(B)))};
g.R(Etp,DB);Etp.prototype.X=function(){var B=[];this.C.parentPlaylist&&B.push(this.C.parentPlaylist);if(this.C.entries)for(var y=g.Y(this.C.entries),a=y.next();!a.done;a=y.next())B.push.apply(B,g.Ee((new wGY(a.value)).X()));return[].concat(g.Ee(new Set(B)))};
g.R(zTp,DB);zTp.prototype.X=function(){var B=[];this.C.descriptionEntity&&B.push(this.C.descriptionEntity);this.C.creators&&B.push.apply(B,g.Ee(this.C.creators));this.C.theBiggestFan&&B.push(this.C.theBiggestFan);return[].concat(g.Ee(new Set(B)))};
g.R(q9Y,DB);q9Y.prototype.X=function(){return[]};
g.R(VEI,DB);VEI.prototype.X=function(){return[]};
g.R(RTO,DB);RTO.prototype.X=function(){return[]};
g.R(u_S,DB);u_S.prototype.X=function(){return[]};
g.R(Y9u,DB);Y9u.prototype.X=function(){return[]};
g.R(Lpp,DB);Lpp.prototype.X=function(){return[]};
g.R(NQK,DB);NQK.prototype.X=function(){return[]};
g.R(bwo,DB);bwo.prototype.X=function(){return[]};
g.R(TQ0,DB);TQ0.prototype.X=function(){return[]};
g.R(pGY,DB);pGY.prototype.X=function(){var B=[];this.C.downloadsList&&B.push(this.C.downloadsList);this.C.smartDownloadsList&&B.push(this.C.smartDownloadsList);this.C.recommendedDownloadsList&&B.push(this.C.recommendedDownloadsList);this.C.refresh&&B.push(this.C.refresh);return[].concat(g.Ee(new Set(B)))};
g.R(tEa,eP);tEa.prototype.X=function(){var B=[];this.C.video&&B.push(this.C.video);this.C.playlist&&B.push(this.C.playlist);this.C.videoItem&&B.push(this.C.videoItem);this.C.playlistItem&&B.push(this.C.playlistItem);return[].concat(g.Ee(new Set(B)))};
g.R(PlY,DB);PlY.prototype.X=function(){var B=[];this.C.refresh&&B.push(this.C.refresh);if(this.C.downloads)for(var y=g.Y(this.C.downloads),a=y.next();!a.done;a=y.next())B.push.apply(B,g.Ee((new tEa(a.value)).X()));return[].concat(g.Ee(new Set(B)))};
g.R(S9Y,DB);S9Y.prototype.X=function(){var B=[];this.C.localImageEntities&&B.push.apply(B,g.Ee(this.C.localImageEntities));return[].concat(g.Ee(new Set(B)))};
g.R(Qb7,DB);Qb7.prototype.X=function(){var B=[];this.C.playbackData&&B.push(this.C.playbackData);this.C.localImageEntities&&B.push.apply(B,g.Ee(this.C.localImageEntities));this.C.videoDownloadContextEntity&&B.push(this.C.videoDownloadContextEntity);return[].concat(g.Ee(new Set(B)))};
g.R(AaI,DB);AaI.prototype.X=function(){return[]};
g.R(FpO,DB);FpO.prototype.X=function(){var B=[];this.C.fakeChildren&&B.push.apply(B,g.Ee(this.C.fakeChildren));return[].concat(g.Ee(new Set(B)))};
g.R(GLS,DB);GLS.prototype.X=function(){var B=[];this.C.video&&B.push(this.C.video);this.C.playbackData&&B.push(this.C.playbackData);this.C.offlineVideoPolicy&&B.push(this.C.offlineVideoPolicy);return[].concat(g.Ee(new Set(B)))};
g.R(eTO,DB);eTO.prototype.X=function(){return[]};
g.R(DCO,DB);DCO.prototype.X=function(){var B=[];this.C.channelOwner&&B.push(this.C.channelOwner);this.C.videos&&B.push.apply(B,g.Ee(this.C.videos));this.C.collaboratorChannels&&B.push.apply(B,g.Ee(this.C.collaboratorChannels));this.C.downloadState&&B.push(this.C.downloadState);this.C.refresh&&B.push(this.C.refresh);return[].concat(g.Ee(new Set(B)))};
g.R(Wpa,DB);Wpa.prototype.X=function(){var B=[];this.C.video&&B.push(this.C.video);this.C.channelContributor&&B.push(this.C.channelContributor);return[].concat(g.Ee(new Set(B)))};
g.R(KpK,eP);KpK.prototype.X=function(){var B=[];this.C.localImageEntities&&B.push.apply(B,g.Ee(this.C.localImageEntities));this.C.videoDownloadContextEntity&&B.push(this.C.videoDownloadContextEntity);return[].concat(g.Ee(new Set(B)))};
g.R(iwu,eP);iwu.prototype.X=function(){var B=[];this.C.recommendedVideoMetadata&&B.push.apply(B,g.Ee((new KpK(this.C.recommendedVideoMetadata)).X()));return[].concat(g.Ee(new Set(B)))};
g.R(XGK,eP);XGK.prototype.X=function(){var B=[];this.C.playbackPosition&&B.push(this.C.playbackPosition);return[].concat(g.Ee(new Set(B)))};
g.R(f8o,DB);f8o.prototype.X=function(){var B=[];this.C.owner&&B.push(this.C.owner);this.C.downloadState&&B.push(this.C.downloadState);this.C.userState&&B.push.apply(B,g.Ee((new XGK(this.C.userState)).X()));this.C.additionalMetadata&&B.push.apply(B,g.Ee((new iwu(this.C.additionalMetadata)).X()));return[].concat(g.Ee(new Set(B)))};
g.R(ME7,DB);ME7.prototype.X=function(){var B=[];this.C.userChannelDetails&&B.push(this.C.userChannelDetails);return[].concat(g.Ee(new Set(B)))};
g.R($CK,DB);$CK.prototype.X=function(){var B=[];this.C.channelOwner&&B.push(this.C.channelOwner);this.C.playbackPosition&&B.push(this.C.playbackPosition);this.C.localImageEntities&&B.push.apply(B,g.Ee(this.C.localImageEntities));this.C.downloadStatus&&B.push(this.C.downloadStatus);return[].concat(g.Ee(new Set(B)))};
g.R(Ow1,DB);Ow1.prototype.X=function(){return[]};
g.R(I8p,DB);I8p.prototype.X=function(){return[]};
g.R(ZwY,DB);ZwY.prototype.X=function(){return[]};
g.R(ntI,DB);ntI.prototype.X=function(){return[]};
g.R(dCo,DB);dCo.prototype.X=function(){return[]};
g.R(UCS,DB);UCS.prototype.X=function(){return[]};
g.R(jbI,DB);jbI.prototype.X=function(){return[]};
g.R(sb1,DB);sb1.prototype.X=function(){return[]};
g.R(hTu,DB);hTu.prototype.X=function(){return[]};
g.R(vto,DB);vto.prototype.X=function(){return[]};
g.R(BlY,DB);BlY.prototype.X=function(){return[]};
g.R(yRY,DB);yRY.prototype.X=function(){return[]};
g.R(avC,DB);avC.prototype.X=function(){var B=[];this.C.trackDownloadMetadatas&&B.push.apply(B,g.Ee(this.C.trackDownloadMetadatas));return[].concat(g.Ee(new Set(B)))};
g.R(rRK,DB);
rRK.prototype.X=function(){var B=[];this.C.downloadedTracks&&B.push.apply(B,g.Ee(this.C.downloadedTracks));this.C.smartDownloadedTracks&&B.push.apply(B,g.Ee(this.C.smartDownloadedTracks));this.C.downloadedEpisodes&&B.push.apply(B,g.Ee(this.C.downloadedEpisodes));this.C.downloadedAlbumReleases&&B.push.apply(B,g.Ee(this.C.downloadedAlbumReleases));this.C.smartDownloadedAlbumReleases&&B.push.apply(B,g.Ee(this.C.smartDownloadedAlbumReleases));this.C.downloadedPlaylists&&B.push.apply(B,g.Ee(this.C.downloadedPlaylists));this.C.smartDownloadedPlaylists&&
B.push.apply(B,g.Ee(this.C.smartDownloadedPlaylists));this.C.metadataOnlyTracks&&B.push.apply(B,g.Ee(this.C.metadataOnlyTracks));return[].concat(g.Ee(new Set(B)))};
g.R(kQ7,DB);kQ7.prototype.X=function(){var B=[];this.C.trackDownloadMetadatas&&B.push.apply(B,g.Ee(this.C.trackDownloadMetadatas));return[].concat(g.Ee(new Set(B)))};
g.R(xrS,DB);xrS.prototype.X=function(){var B=[];this.C.playbackData&&B.push(this.C.playbackData);this.C.localImageEntities&&B.push.apply(B,g.Ee(this.C.localImageEntities));this.C.videoDownloadContextEntity&&B.push(this.C.videoDownloadContextEntity);return[].concat(g.Ee(new Set(B)))};
g.R(JRY,DB);JRY.prototype.X=function(){var B=[];this.C.musicLibraryStatusEntity&&B.push(this.C.musicLibraryStatusEntity);this.C.primaryArtists&&B.push.apply(B,g.Ee(this.C.primaryArtists));this.C.details&&B.push(this.C.details);this.C.userDetails&&B.push(this.C.userDetails);this.C.tracks&&B.push.apply(B,g.Ee(this.C.tracks));this.C.share&&B.push(this.C.share);this.C.downloadMetadata&&B.push(this.C.downloadMetadata);this.C.refresh&&B.push(this.C.refresh);return[].concat(g.Ee(new Set(B)))};
g.R(Hx1,DB);Hx1.prototype.X=function(){var B=[];this.C.albumRelease&&B.push(this.C.albumRelease);this.C.tracks&&B.push.apply(B,g.Ee(this.C.tracks));return[].concat(g.Ee(new Set(B)))};
g.R(mrp,DB);mrp.prototype.X=function(){var B=[];this.C.albumRelease&&B.push(this.C.albumRelease);return[].concat(g.Ee(new Set(B)))};
g.R(on1,DB);on1.prototype.X=function(){var B=[];this.C.details&&B.push(this.C.details);this.C.userDetails&&B.push(this.C.userDetails);return[].concat(g.Ee(new Set(B)))};
g.R(CLV,DB);CLV.prototype.X=function(){var B=[];this.C.parentArtist&&B.push(this.C.parentArtist);return[].concat(g.Ee(new Set(B)))};
g.R(gnC,DB);gnC.prototype.X=function(){var B=[];this.C.parentArtist&&B.push(this.C.parentArtist);return[].concat(g.Ee(new Set(B)))};
g.R(lv7,DB);lv7.prototype.X=function(){return[]};
g.R(cRY,DB);cRY.prototype.X=function(){return[]};
g.R(wbu,eP);wbu.prototype.X=function(){var B=[];this.C.creatorEntity&&B.push(this.C.creatorEntity);return[].concat(g.Ee(new Set(B)))};
g.R(EnI,DB);
EnI.prototype.X=function(){var B=[];this.C.tracks&&B.push.apply(B,g.Ee(this.C.tracks));this.C.refresh&&B.push(this.C.refresh);this.C.musicLibraryStatusEntity&&B.push(this.C.musicLibraryStatusEntity);this.C.details&&B.push(this.C.details);this.C.downloadMetadata&&B.push(this.C.downloadMetadata);this.C.sideloadMetadata&&B.push(this.C.sideloadMetadata);this.C.userDetails&&B.push(this.C.userDetails);this.C.entryCollection&&B.push(this.C.entryCollection);this.C.share&&B.push(this.C.share);this.C.podcastShowAdditionalMetadata&&
B.push.apply(B,g.Ee((new wbu(this.C.podcastShowAdditionalMetadata)).X()));return[].concat(g.Ee(new Set(B)))};
g.R(zaK,DB);zaK.prototype.X=function(){return[]};
g.R(qVC,DB);
qVC.prototype.X=function(){var B=[];this.C.musicLibraryStatusEntity&&B.push(this.C.musicLibraryStatusEntity);this.C.artists&&B.push.apply(B,g.Ee(this.C.artists));this.C.audioModeVersion&&B.push(this.C.audioModeVersion);this.C.videoModeVersion&&B.push(this.C.videoModeVersion);this.C.userDetails&&B.push(this.C.userDetails);this.C.details&&B.push(this.C.details);this.C.albumRelease&&B.push(this.C.albumRelease);this.C.share&&B.push(this.C.share);this.C.libraryEdit&&B.push(this.C.libraryEdit);this.C.downloadMetadata&&
B.push(this.C.downloadMetadata);this.C.playbackPosition&&B.push(this.C.playbackPosition);this.C.lyrics&&B.push(this.C.lyrics);return[].concat(g.Ee(new Set(B)))};
g.R(VAu,DB);VAu.prototype.X=function(){var B=[];this.C.parentTrack&&B.push(this.C.parentTrack);return[].concat(g.Ee(new Set(B)))};
g.R(Rau,DB);Rau.prototype.X=function(){var B=[];this.C.parentTrack&&B.push(this.C.parentTrack);return[].concat(g.Ee(new Set(B)))};
g.R(uLI,DB);uLI.prototype.X=function(){return[]};
g.R(YVu,DB);YVu.prototype.X=function(){return[]};
g.R(LVO,DB);LVO.prototype.X=function(){return[]};
g.R(NlO,DB);NlO.prototype.X=function(){return[]};
g.R(bxu,DB);bxu.prototype.X=function(){var B=[];this.C.transfer&&B.push(this.C.transfer);this.C.adsPlaybackData&&B.push.apply(B,g.Ee(this.C.adsPlaybackData));this.C.drmLicense&&B.push(this.C.drmLicense);this.C.offlineVideoPolicy&&B.push(this.C.offlineVideoPolicy);this.C.videoDownloadContextEntity&&B.push(this.C.videoDownloadContextEntity);return[].concat(g.Ee(new Set(B)))};
g.R(TlK,DB);TlK.prototype.X=function(){return[]};
g.R(pb0,DB);pb0.prototype.X=function(){var B=[];this.C.offlineVideoStreams&&B.push.apply(B,g.Ee(this.C.offlineVideoStreams));this.C.captionTrack&&B.push.apply(B,g.Ee(this.C.captionTrack));return[].concat(g.Ee(new Set(B)))};
g.R(tAo,DB);tAo.prototype.X=function(){return[]};
g.R(PL1,DB);PL1.prototype.X=function(){return[]};
g.R(SVY,DB);SVY.prototype.X=function(){return[]};
g.R(QtY,DB);QtY.prototype.X=function(){return[]};
g.R(AR0,DB);AR0.prototype.X=function(){return[]};
g.R(FVK,DB);FVK.prototype.X=function(){return[]};
g.R(GQY,DB);GQY.prototype.X=function(){return[]};
g.R(eaK,DB);eaK.prototype.X=function(){return[]};
g.R(DrC,DB);DrC.prototype.X=function(){return[]};
g.R(WV1,DB);WV1.prototype.X=function(){return[]};
g.R(KVp,DB);KVp.prototype.X=function(){return[]};
g.R(ix1,DB);ix1.prototype.X=function(){return[]};
g.R(XbO,DB);XbO.prototype.X=function(){return[]};
g.R(fvK,DB);fvK.prototype.X=function(){return[]};
g.R(MA0,DB);MA0.prototype.X=function(){return[]};
g.R($r0,DB);$r0.prototype.X=function(){return[]};
g.R(OxY,DB);OxY.prototype.X=function(){return[]};
g.R(IvO,DB);IvO.prototype.X=function(){return[]};
g.R(Zxp,DB);Zxp.prototype.X=function(){return[]};
g.R(nnY,DB);nnY.prototype.X=function(){return[]};
g.R(dr0,DB);dr0.prototype.X=function(){return[]};
var nk1=["browse","music/browse","unplugged/browse"],hIa=["offline/playlist_sync_check"],KM7=["offline"],d1I=["offline/offline_video_playback_position_sync"],j9o=["offline/get_playback_data_entity"],WU;Kd.getInstance=function(){return g.F(function(B){return B.return(new Promise(function(y){g.$x().then(function(a){a?(Kd.instance||(Kd.instance=new Kd(a)),y(Kd.instance)):y(void 0)})}))})};
Kd.prototype.get=function(B){var y=this,a,r,k;return g.F(function(x){if(x.X==1)return g.Q(x,ha7(y.token),2);if(x.X!=3)return a=x.C,g.Q(x,a.get("prefs",B),3);r=x.C;if(!r)return x.return();k=(0,g.V4)();return r.expirationTimestampMs<=k?x.return():x.return(r.value)})};
Kd.prototype.set=function(B,y,a){a=a===void 0?31536E3:a;var r=this,k,x,J;return g.F(function(m){if(m.X==1)return k=(0,g.V4)(),x={key:B,value:y,expirationTimestampMs:k+a*1E3},g.Q(m,ha7(r.token),2);J=m.C;return g.Q(m,g.bb(J,"prefs",x),0)})};
Kd.prototype.remove=function(B){var y=this,a;return g.F(function(r){if(r.X==1)return g.Q(r,ha7(y.token),2);a=r.C;return g.Q(r,a.delete("prefs",B),0)})};
g.R(iP,g.Ku);g.R(Xx,rAY);Xx.prototype.D=function(B,y){y=xH0(y);B=(new TextEncoder).encode(JSON.stringify(B));return this.C.encrypt(B,y)};
Xx.prototype.X=function(B,y){if(!(B instanceof Uint8Array))throw vn0(1);var a=new TextDecoder;y=xH0(y);B=this.C.decrypt(B,y);return JSON.parse(a.decode(B))};
var JA7={accountLinkStatusEntity:RTO,booleanEntity:ClY,buttonEntity:fvK,captionTrack:uLI,channelHandle:mCV,chipEntity:GQY,commerceAcquisitionClientPayloadEntity:$r0,commerceCartListEntity:OxY,contextNoteFeedEntityPayload:otS,continuationTokenEntity:eTO,downloadQualityPickerEntity:NQK,downloadsPageRefreshTokenEntity:TQ0,downloadsPageViewConfigurationEntity:Ow1,downloadStatusEntity:bwo,dismissState:eaK,sfvAudioItemCurrentlyPlayingEntity:QtY,emojiFountainDataEntity:ix1,emojiCustomizationSetEntity:KVp,
fakeChannel:l8S,fakePlaylist:caS,fakePlaylistEntryCollection:Etp,fakeVideo:zTp,fakeVideoDescription:q9Y,featuredProductsEntity:vto,flowStateEntity:VEI,iconBadgeEntity:IvO,interstitialInteractionStateEntity:Y9u,likeButtonAnimationEntity:I8p,liveChatPollStateEntity:Lpp,liveViewerLeaderboardChatEntryPointStateEntity:PL1,liveViewerLeaderboardPointsEntity:SVY,liveReactionsDataEntity:XbO,logoEntity:u_S,macroMarkerEntity:ZwY,mainDownloadsLibraryEntity:pGY,mainDownloadsListEntity:PlY,mainPlaylistDownloadStateEntity:S9Y,
mainPlaylistEntity:DCO,mainPlaylistVideoEntity:Wpa,mainVideoDownloadStateEntity:Qb7,mainVideoEntity:f8o,markersEngagementPanelSyncEntity:ntI,markersVisibilityOverrideEntity:dCo,musicAlbumReleaseDetail:Hx1,musicAlbumReleaseDownloadMetadataEntity:avC,musicAlbumRelease:JRY,musicAlbumReleaseUserDetail:mrp,musicArtistDetail:CLV,musicArtist:on1,musicArtistUserDetail:gnC,musicDownloadsLibraryEntity:rRK,musicLibraryEdit:lv7,musicLibraryStatusEntity:cRY,musicPlaylist:EnI,musicPlaylistDownloadMetadataEntity:kQ7,
musicShare:zaK,musicTrackDetail:VAu,musicTrackDownloadMetadataEntity:xrS,musicTrack:qVC,musicTrackUserDetail:Rau,offlineOrchestrationActionWrapperEntity:YVu,offlineVideoPolicy:LVO,offlineVideoStreams:NlO,offlineabilityEntity:AaI,orchestrationWebSamplingEntity:FpO,pageHeaderEntity:DrC,pdpStateEntity:Zxp,pinnedProductEntity:BlY,playbackData:bxu,playerStateEntity:UCS,quantityIncrementerEntity:nnY,refresh:TlK,saveToPlaylistListEntity:AR0,selectedChipIndexEntityPayload:jbI,settingEntity:FVK,stringEntity:gtp,
suggestedFeedbackChipStateEntity:sb1,transfer:pb0,trendingOfferEntity:yRY,videoDownloadContextEntity:tAo,videoOverviewAsyncDataEntity:dr0,videoPlaybackPositionEntity:MA0,votingEntity:WV1,ytMainChannelEntity:ME7,youchatPendingResponseEntity:hTu,ytMainDownloadedVideoEntity:GLS,ytMainVideoEntity:$CK};g.R(ZB,rAY);ZB.prototype.D=function(B){return B};
ZB.prototype.X=function(B){if(B instanceof Uint8Array)throw vn0(0);return B};
g.R(nd,g.W);nd.prototype.observe=function(B){var y=this;this.observers.push(B);return function(){var a=y.observers.indexOf(B);a>=0&&y.observers.splice(a,1)}};
nd.prototype.X=function(B){uQO(this,B.data)};
nd.prototype.lw=function(){this.channel.close()};
var Taa,NDu=new g.qz("elementsCommand");var Nd=new g.qz("entityBatchUpdate");var gk0=new g.qz("downloadStatusEntity");var tfV=new g.qz("mainPlaylistEntityActionMetadata");var UQ=new g.qz("mainVideoEntityActionMetadata");var WMC=new g.qz("musicPlaylistEntityActionMetadata");var mzY=new g.qz("musicTrackEntityActionMetadata");var $51=new g.qz("localImageEntityActionMetadata");var eT=new g.qz("playbackDataActionMetadata");var bXS=new g.qz("transferEntityActionMetadata");var ohY=new g.qz("videoPlaybackPositionEntityActionMetadata");var f2p;new g.JX;new g.JX;Z8Y.prototype.request=function(B,y,a){y=y===void 0?{}:y;return this.locks.request(B,y,function(r){return a(r)})};var an=g.vE.caches,yb,sBa;BW.prototype.open=function(B){return an.open(UH0(B))};
BW.prototype.has=function(B){return an.has(UH0(B))};
BW.prototype.delete=function(B){return an.delete(UH0(B))};
BW.prototype.match=function(B,y){var a=this,r,k,x,J,m,C;return g.F(function(l){switch(l.X){case 1:return g.Q(l,a.keys(),2);case 2:r=l.C,k=g.Y(r),x=k.next();case 3:if(x.done){l.dQ(5);break}J=x.value;return g.Q(l,a.open(J),6);case 6:return m=l.C,g.Q(l,m.match(B,y),7);case 7:if(C=l.C)return l.return(C);x=k.next();l.dQ(3);break;case 5:return l.return()}})};
g.R(dHp,BW);dHp.prototype.keys=function(){var B,y,a,r,k,x,J,m,C;return g.F(function(l){if(l.X==1)return B=[],y=g.iQ("CacheStorage keys"),g.Q(l,an.keys(),2);a=l.C;r=g.Y(a);for(k=r.next();!k.done;k=r.next()){x=k.value;var c=x.indexOf(":");J=c===-1?{zA:x}:{zA:x.substring(0,c),datasyncId:x.substring(c+1)};m=J.zA;C=J.datasyncId;C===y&&B.push(m)}return l.return(B)})};g.R(kl,g.W);kl.prototype.D=function(B){this.api.Kh("onOfflineOperationFailure",B.data)};
kl.prototype.J=function(B){this.api.publish("offlinetransferpause",B.data)};
kl.prototype.lw=function(){var B;(B=this.C)==null||B.close();var y;(y=this.X)==null||y.close()};BDp.prototype.pV=function(){this.C&&JF(this)};
BDp.prototype.Ro=function(){this.X&&this.X.resolve();this.D=this.C=!1;this.U()};var ftC=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var uKK="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var AXa="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.R(Bmp,AF);Bmp.prototype.X=function(B){return CA(B)?rCu(this,B):gg(B)?JCO(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.R(HXI,AF);HXI.prototype.X=function(B){return gg(B)?mvp(this,B):CXO(B)?CfY(this,B):lO(B)?ghC(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.V=ltY.prototype;g.V.y77=function(B){var y=this,a,r,k,x;return g.F(function(J){if(!g.Z(B.state,128))return J.dQ(0);a=B.state.mp;var m=(r=a)==null?void 0:r.errorCode,C=(k=a)==null?void 0:k.yC;x=m==="net.connect"&&C===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(m==null?0:m.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.Q(J,y.wJ(y.player.getVideoData().videoId,x),0)})};
g.V.wJ=function(B,y){var a=this;return g.F(function(r){if(r.X==1){if(a.X)return r.return();a.X=!0;return y==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(KA(a,B,!1,!0),r.dQ(0)):g.Q(r,WW(a,B),3)}g.Iy(B,4);return g.Q(r,a.C.wJ(y),0)})};
g.V.tH=function(B){B.status===2?(B.status!==this.D&&(m5p(this.C),g.Iy(B.videoId,2)),B.NS&&c_C(this.C,B.videoId,B.NS)):B.status===4?(WW(this,B.videoId),this.wJ(B.videoId,B.nQ?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):B.status===1&&lnS(this.C);this.D=B.status;this.api.Kh("localmediachange",{videoId:B.videoId,status:B.status})};
g.V.uK=function(){var B=this,y;return g.F(function(a){if(a.X==1){if(B.X)return a.return();B.X=!0;y=B.player.getVideoData().videoId;return g.Q(a,WW(B,y),2)}return g.Q(a,B.C.uK(),0)})};
g.V.Xh=function(B){switch(B){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.V.Z=function(B){return this.api.Y().Z(B)};g.R(RGK,AF);RGK.prototype.X=function(B){return CA(B)?YGI(this,B):gg(B)?LOK(this,B):CXO(B)?NmS(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};SGY.prototype.C=function(B,y){var a=B.action.actionMetadata.priority-y.action.actionMetadata.priority;a===0&&(B.C<y.C?a=-1:B.C>y.C&&(a=1));return a};g.R(iO,g.W);iO.prototype.lw=function(){this.U&&this.U();g.W.prototype.lw.call(this)};
iO.prototype.createAction=function(B,y){var a=g.$J(B.entityKey).entityType,r=g.CM(16);return new qd(a,r,B,y.actionId,y.rootActionId)};
iO.prototype.Ch=function(B){var y=this,a,r,k,x,J,m,C,l,c;return g.F(function(w){if(w.X==1){if(y.fh())return w.return();r=(a=B.offlineOrchestrationActionWrapperEntity)!=null?a:new Set;k=[];x=g.Y(r);for(J=x.next();!J.done;J=x.next())m=J.value,C=g.$J(m),l=C.entityId,FOS(y.C,l)||k.push(m);return g.Q(w,OXI(y,k),2)}c=w.C;return g.Q(w,$vY(y,c),0)})};
iO.prototype.retry=function(){var B=this;return g.F(function(y){return g.Q(y,ItV(B),0)})};nhK.prototype.VN=function(B,y){y=y===void 0?!0:y;var a=this,r,k,x,J,m,C,l,c;return g.F(function(w){switch(w.X){case 1:if(!a.C)return w.return();r=[];k=g.kR(a.C.X,y);x=[];for(J={Do:0};J.Do<k.length;J={Do:J.Do},J.Do++)m=k[J.Do],C=a.C.gA(m,"json3"),l=g.Yr(C,{withCredentials:!0,format:"RAW"},3,500).then(function(E){return function(z){z={metadata:g.SG(k[E.Do]),trackData:z.xhr.responseText};x.push(z)}}(J)).eE(function(E){rg("Caption fetch error",E)}),r.push(l);
return g.Q(w,HwY(r),2);case 2:return g.TU(w,3),g.Q(w,Go0(B,x),5);case 5:g.PE(w,0);break;case 3:c=g.Sx(w),rg("Caption DB transaction error",c),g.bJ(w)}})};g.R(XP,g.W);XP.prototype.lw=function(){this.X&&this.X();g.W.prototype.lw.call(this)};
XP.prototype.D=function(B){var y=this,a,r,k,x,J,m,C,l;return g.F(function(c){r=(a=B.transfer)!=null?a:new Set;k=[];x=g.Y(r);for(J=x.next();!J.done;J=x.next())m=J.value,C=g.$J(m),l=C.entityId,k.push(l);return k.length===0?c.return():g.Q(c,jJC(y,k),0)})};g.R(y_1,g.W);g.V=y_1.prototype;g.V.lw=function(){this.Xx&&this.Xx();this.J7.dispose();this.J.dispose();this.vk&&g.OV(this.T.BQ,this.vk);this.uw&&g.OV(this.T.BQ,this.uw);g.W.prototype.lw.call(this)};
g.V.TzQ=function(B){var y=this,a,r,k;return g.F(function(x){switch(x.X){case 1:a=g.Oh(B,"transfer");if(y.C&&a===y.C.key){KA(y.N,y.j,!0);y.J.stop();x.dQ(0);break}return g.Q(x,dw(y.X,{mode:"readwrite",Ei:!0},function(J){return fd(J,a,"transfer").then(function(m){if(m&&m.transferState!=="TRANSFER_STATE_COMPLETE"&&m.transferState!=="TRANSFER_STATE_FAILED")return m.transferState="TRANSFER_STATE_PAUSED_BY_USER",Ou(J,m,"transfer").then(function(){return m})})}),3);
case 3:r=x.C;if(!r){x.dQ(0);break}if(!B||!y.D){x.dQ(5);break}return g.Q(x,cW(B,y.D,y.X,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.Q(x,$l(y,B),7);case 7:k=x.C,m1K({videoId:B,Jm:r,offlineModeType:k}),g.bJ(x)}})};
g.V.zMf=function(){var B=this;if(this.C&&this.j){KA(this.N,this.j,!1);var y=this.C,a=(y==null?0:y.key)?g.$J(y.key).entityId:"";a&&this.D&&(new Promise(function(r,k){cW(a,B.D,B.X,"DOWNLOAD_STATE_PAUSED").catch(function(x){k(x)})})).catch(function(r){rg("Download state setting error",r)})}this.J.stop()};
g.V.Xd=function(){this.C?kTY(this,this.C):Md(this)};
g.V.fm=function(B){var y=this;return g.F(function(a){switch(a.X){case 1:if(!y.C){a.dQ(2);break}if(y.C.transferState==="TRANSFER_STATE_COMPLETE"||y.C.transferState==="TRANSFER_STATE_FAILED"||!B.transfer||!B.transfer.has(y.C.key)){a.dQ(3);break}return g.Q(a,jP(y.X,y.C.key,"transfer"),4);case 4:y.C=a.C;if(y.C){a.dQ(3);break}return g.Q(a,x51(y),3);case 3:if(y.C)return a.return();case 2:return g.Q(a,Md(y),0)}})};
g.V.wJ=function(B,y){var a=this,r,k,x,J,m;return g.F(function(C){switch(C.X){case 1:if(!a.C){OQ(a,"onTransferFailure: "+B);C.dQ(2);break}r=a.C;x=((k=r)==null?0:k.key)?g.$J(r.key).entityId:"";a:switch(B){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var l=!1;break a;default:l=!0}return l&&w1u(a)?g.Q(C,In(a,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.Q(C,
EiC(a,B),5);case 5:if(!x||!a.D){C.dQ(2);break}return g.Q(C,cW(x,a.D,a.X,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.Q(C,$l(a,x),9);case 9:J=C.C;mc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:x,Jm:r,offlineModeType:J});if(!x||!a.D){C.dQ(2);break}return g.Q(C,cW(x,a.D,a.X,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:fA(a),m=Md(a,!0),y&&y(m),g.bJ(C)}})};
g.V.uK=function(B){var y=this,a,r,k,x,J,m,C,l,c,w,E,z;return g.F(function(q){switch(q.X){case 1:if(!y.C){OQ(y,"onMaybeTransferStreamsExpired");q.dQ(2);break}return w1u(y)?g.Q(q,In(y,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.Q(q,EiC(y,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!y.D){q.dQ(2);break}a=y.C;k=((r=a)==null?0:r.key)?g.$J(a.key).entityId:"";if(!k){q.dQ(2);break}return g.Q(q,cW(k,y.D,y.X,"DOWNLOAD_STATE_FAILED"),2);case 9:return y.C||OQ(y,"onMaybeTransferStreamsExpiredRetryAttempting"),
x=y.C,m=((J=x)==null?0:J.key)?g.$J(x.key).entityId:"",g.Q(q,$l(y,m),10);case 10:return C=q.C,mc({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:m,Jm:x,offlineModeType:C}),l=wkS(),g.tk(l,eT,{isEnqueuedForExpiredStreamUrlRefetch:!0}),c=g.Oh(m,"playbackData"),w={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:c,actionMetadata:l},E=Rn(new qd("playbackData",m,w)),g.Q(q,Uu(y.X,E,"offlineOrchestrationActionWrapperEntity"),2);case 2:fA(y),z=Md(y,!0),
B&&B(z),g.bJ(q)}})};
var Rsa={},zea=(Rsa.TRANSFER_STATE_TRANSFERRING=1,Rsa.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,Rsa);g.V=Zs.prototype;g.V.bG=function(){return this.j.promise};
g.V.uu=function(){if(this.X&&this.N)return this.j.promise;ReO(this).then(this.j.resolve).catch(this.j.reject);return this.j.promise};
g.V.BY=function(B){var y={};return y.playbackData=new Bmp(B,this.Pk,this.C),y.transfer=new RGK(B,this.Pk),y.videoPlaybackPositionEntity=new HXI(B,this.Pk),y};
g.V.k7=function(){var B=this;return g.F(function(y){return B.X?g.Q(y,anV(B.X),0):y.dQ(0)})};
g.V.TV=function(){var B=this,y,a;return g.F(function(r){if(r.X==1)return B.X||B.N?g.Q(r,B.bG(),2):r.return();B.K!==void 0&&(g.Co(B.K),B.K=void 0);B.J!==void 0&&(g.Co(B.J),B.J=void 0);(y=B.X)==null||y.dispose();B.X=void 0;(a=B.N)==null||a.dispose();B.N=void 0;B.api.Kh("onOrchestrationLostLeader");B.j=new g.JX;g.bJ(r)})};
g.V.isOrchestrationLeader=function(){return this.D.C};
g.V.QH=function(){return g.F(function(B){return B.return(!1)})};
g.V.wH=function(B){var y=this.C;y.api.publish("offlinetransferpause",B);var a;(a=y.X)==null||a.postMessage(B)};
g.V.Xd=function(B){var y,a;return g.F(function(r){if(r.X==1)return g.Q(r,vU(),2);y=r.C;if(!y)return r.return();a=g.Oh(B,"transfer");return g.Q(r,dw(y,{mode:"readwrite",Ei:!0},function(k){var x=fd(k,a,"transfer"),J=fd(k,g.Oh(B,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.wj.all([x,J]).then(function(m){m=g.Y(m);var C=m.next().value;var l=m.next().value;return C&&C.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Ou(k,C,"transfer").then(function(){mc({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:B,Jm:C,offlineModeType:l==null?void 0:l.offlineModeType});return g.wj.resolve(null)})):g.wj.resolve(null)})}),0)})};
g.V.vI=function(B){B=B===void 0?43200:B;var y=this,a,r,k,x,J,m,C,l;return g.F(function(c){if(c.X==1)return y.T.qa()?g.Q(c,vU(),2):c.return(ueo());if(c.X!=3){a=c.C;if(!a)return c.return([]);r=Date.now()/1E3;return g.Q(c,hn(a,"offlineVideoPolicy"),3)}k=c.C;x=[];J=g.Y(k);for(m=J.next();!m.done;m=J.next())C=m.value,Number(C.lastUpdatedTimestampSeconds)+B<=r&&(l=g.$J(C.key).entityId,x.push(l));return x.length?c.return(nA(y,x,y.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):c.return([])})};
g.V.deleteAll=function(){return nA(this,["!*$_ALL_ENTITIES_!*$"],this.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.V.refreshAllStaleEntities=function(B){var y=this;return g.F(function(a){return a.X==1?g.Q(a,y.vI(B),2):a.return(a.C)})};
g.V.setUpPositionSyncInterval=function(B){var y=this;this.J!==void 0&&(g.Co(this.J),this.J=void 0);var a=B!=null?B:864E5;this.J=g.mA(function(){y.mC(a)},a)};
g.V.mC=function(B){var y=this,a,r,k,x,J,m;return g.F(function(C){switch(C.X){case 1:return g.TU(C,2),g.Q(C,Kd.getInstance(),4);case 4:a=C.C;if(!a)throw Error("prefStorage is undefined");return g.Q(C,a.get("psi"),5);case 5:r=C.C;x=((k=r)==null?0:k.xN)?Number(r.xN)/1E3:0;J=Date.now();if(!(x+B<=J)){C.dQ(6);break}return g.Q(C,nA(y,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.PE(C,0);break;case 2:m=g.Sx(C),rg("Offline manager error",m),
g.bJ(C)}})};
g.V.ZY=function(){var B=this,y,a,r,k,x,J,m;return g.F(function(C){if(C.X==1)return g.Q(C,vU(),2);if(C.X!=3)return(y=C.C)?g.Q(C,hn(y,"transfer"),3):C.return([]);a=C.C;r=[];k=g.Y(a);for(x=k.next();!x.done;x=k.next())J=x.value,J.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&J.key&&(m=g.$J(J.key).entityId,r.push(m));return C.return(L20(B,r))})};
g.V.Ud=function(){return g.F(function(B){return B.return([])})};
g.V.fS=function(){return g.F(function(B){g.bJ(B)})};
g.V.mH=function(){return g.F(function(B){g.bJ(B)})};g.R(NG7,AF);NG7.prototype.X=function(B){return CA(B)?p1V(this,B):gg(B)?PWY(this,B):lO(B)?SOI(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var dg=[10];g.R(eeo,AF);eeo.prototype.X=function(B){return CA(B)?K2K(this,B):gg(B)?i$u(this,B):lO(B)?X1V(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var W27=[10];g.R(MfV,AF);MfV.prototype.X=function(B){return gg(B)?O$V(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};g.R(Ino,Zs);g.V=Ino.prototype;g.V.BY=function(B){var y=Zs.prototype.BY.call(this,B);y.mainVideoEntity=new eeo(B,this.Pk,this.C);y.mainPlaylistEntity=new NG7(B,this.Pk,this.C);y.mainDownloadsListEntity=new MfV(B,this.Pk,this.C);return y};
g.V.refreshAllStaleEntities=function(B,y){var a=this,r,k,x,J,m,C,l,c,w,E,z;return g.F(function(q){switch(q.X){case 1:r=[];if(!a.Pk.Z("web_player_offline_playlist_auto_refresh")){q.dQ(2);break}return g.Q(q,Z$K(a,B,y),3);case 3:r=q.C;case 2:return g.Q(q,Kd.getInstance(),4);case 4:return k=q.C,g.Q(q,(x=k)==null?void 0:x.get("sdois"),5);case 5:return J=q.C,g.Q(q,(m=k)==null?void 0:m.get("lmqf"),6);case 6:C=q.C;if(!J){q.dQ(7);break}c=r;w=c.concat;return g.Q(q,niS(a,J,(l=C)!=null?l:"SD",B===0),8);case 8:r=
w.call(c,q.C);case 7:return E=r,z=E.concat,g.Q(q,Zs.prototype.refreshAllStaleEntities.call(a,B,y),9);case 9:return r=z.call(E,q.C),q.return(r)}})};
g.V.QH=function(B){var y,a,r,k,x,J,m,C;return g.F(function(l){if(l.X==1)return g.Q(l,vU(),2);if(l.X!=3)return(y=l.C)?g.Q(l,jP(y,g.iF,"mainDownloadsListEntity"),3):l.return(!1);a=l.C;if((r=a)==null?0:(k=r.downloads)==null?0:k.length)for(x=g.Oh(B,"mainVideoEntity"),J=g.Y(a.downloads),m=J.next();!m.done;m=J.next())if(C=m.value,C.videoItem===x)return l.return(!0);return l.return(!1)})};
g.V.Ud=function(){var B=this,y,a,r,k,x,J,m,C;return g.F(function(l){if(l.X==1)return g.Q(l,vU(),2);if(l.X!=3)return(y=l.C)?g.Q(l,hn(y,"downloadStatusEntity"),3):l.return([]);a=l.C;r=[];k=g.Y(a);for(x=k.next();!x.done;x=k.next())J=x.value,J.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&J.key&&(m=g.$J(J.key).entityId,r.push(m));return r.length?(C={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},l.return(nA(B,r,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
C))):l.return([])})};
g.V.mH=function(){var B;return g.F(function(y){return y.X==1?g.Q(y,vU(),2):(B=y.C)?g.Q(y,dw(B,{mode:"readwrite",Ei:!0},function(a){return MX(a,"mainVideoEntity").then(function(r){var k=[];r=g.Y(r);for(var x=r.next();!x.done;x=r.next()){x=x.value;var J=void 0;(J=x.userState)!=null&&J.playbackPosition||(J=g.$J(x.key).entityId,J={key:g.Oh(J,"videoPlaybackPositionEntity"),videoId:J,lastPlaybackPositionSeconds:"0"},k.push(Ou(a,J,"videoPlaybackPositionEntity")),x.userState={playbackPosition:J.key},k.push(Ou(a,
x,"mainVideoEntity")))}return g.wj.all(k)})}),0):y.return()})};
g.V.fS=function(){var B,y,a,r,k,x,J,m,C,l,c,w,E,z,q,L,b,S,P,A,D,M,U,n,xW,C4,HE,g$$,yr,YW,ex,BC,ia,Ro,iJ,s7,E7,O7;return g.F(function(yO){if(yO.X==1)return g.Q(yO,vU(),2);if(yO.X!=3){B=yO.C;if(!B)return yO.return();y=g.Oh("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.Q(yO,dw(B,{mode:"readonly",Ei:!0},function(t){return g.wj.all([fd(t,y,"mainDownloadsListEntity"),fd(t,g.iF,"mainDownloadsListEntity"),MX(t,"mainVideoEntity"),MX(t,"mainPlaylistEntity")])}),3)}a=yO.C;
r=g.Y(a);k=r.next().value;x=r.next().value;J=r.next().value;m=r.next().value;C=k;l=x;c=J;w=m;E=new Set;if((z=C)==null?0:(q=z.downloads)==null?0:q.length)for(L=g.Y(C.downloads),b=L.next();!b.done;b=L.next())S=b.value,P=void 0,(A=(P=S.videoItem)!=null?P:S.playlistItem)&&E.add(A);if((D=l)==null?0:(M=D.downloads)==null?0:M.length)for(U=g.Y(l.downloads),n=U.next();!n.done;n=U.next())xW=n.value,xW.videoItem&&E.add(xW.videoItem);C4=new Set;HE=[];g$$=g.Y(w);for(yr=g$$.next();!yr.done;yr=g$$.next()){YW=yr.value;
if(YW.videos)for(ex=g.Y(YW.videos),BC=ex.next();!BC.done;BC=ex.next())ia=BC.value,(Ro=JSON.parse(g.$J(ia).entityId).videoId)&&C4.add(Ro);YW.key&&!E.has(YW.key)&&HE.push(YW.key)}iJ=g.Y(c);for(s7=iJ.next();!s7.done;s7=iJ.next())E7=s7.value,E7.key&&!E.has(E7.key)&&(O7=g.$J(E7.key).entityId,C4.has(O7)||HE.push(E7.key));return HE.length?g.Q(yO,t1K(B,HE),0):yO.dQ(0)})};g.R(d57,AF);d57.prototype.X=function(B){return CA(B)?jQY(this,B):gg(B)?sQ0(this,B):lO(B)?heo(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var jT=[10];g.R(BnI,AF);BnI.prototype.X=function(B){return CA(B)?ara(this,B):gg(B)?rDC(this,B):lO(B)?kyK(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var sQ=[10];g.R(H6S,AF);H6S.prototype.X=function(B){return CA(B)?gQ7(this,B):gg(B)?lrI(this,B):lO(B)?cD7(this,B):Promise.reject(Error("Unsupported action type: "+B.actionType))};
var CoK=[10];g.R(hF,Zs);hF.prototype.BY=function(B){var y=Zs.prototype.BY.call(this,B);y.musicTrack=new H6S(B,this.C);y.musicPlaylist=new BnI(B,this.C);y.musicAlbumRelease=new d57(B,this.C);return y};
hF.prototype.refreshAllStaleEntities=function(B,y){var a=this,r,k,x;return g.F(function(J){if(J.X==1)return g.Q(J,EQ0(a,B,y),2);if(J.X!=3)return k=r=J.C,x=k.concat,g.Q(J,Zs.prototype.refreshAllStaleEntities.call(a,B,y),3);r=x.call(k,J.C);return J.return(r)})};g.R(zsY,g.N8);g.V=zsY.prototype;g.V.create=function(){var B=this;g.K(this,this.events);if(g.oy(this.Pk))this.C=new Ino(this.Pk,this.player);else if(g.tM(this.Pk)||g.gC(this.Pk))this.C=new hF(this.Pk,this.player);this.events.L(this.player,"onPlaybackStartExternal",function(){B.l$()});
this.events.L(this.player,"videodatachange",function(){B.l$()});
this.Pk.Z("html5_offline_playback_position_sync")&&this.events.L(this.player,"presentingplayerstatechange",this.KI)};
g.V.XI=function(){return!1};
g.V.Uf=function(B,y,a,r){var k=this;return g.F(function(x){return k.C?x.return(nA(k.C,B,y,a,r)):x.return(Promise.reject())})};
g.V.deleteAll=function(){return this.C.deleteAll()};
g.V.vI=function(B){return this.C.vI(B)};
g.V.refreshAllStaleEntities=function(B){return this.C.refreshAllStaleEntities(B)};
g.V.setUpPositionSyncInterval=function(B){this.C.setUpPositionSyncInterval(B)};
g.V.wH=function(B){this.C.wH(B)};
g.V.Xd=function(B){return this.C.Xd(B)};
g.V.l$=function(){var B=this,y;return g.F(function(a){y=B.player.getVideoData();return g.ko(y)?qvo(y)&&B.X!==y.clientPlaybackNonce?g.Q(a,VcY(B,y),0):a.dQ(0):a.return()})};
g.V.KI=function(B){var y=this,a,r,k,x,J,m,C;return g.F(function(l){if(l.X==1)return a=y.player.getVideoData(),r=a.YC,g.xu(B,2)||g.xu(B,512)?g.Q(l,vU(),2):l.return();if(l.X!=3){k=l.C;if(!k)return rg("PES is undefined"),l.return();x=a.videoId;return g.Q(l,jP(k,g.Oh(x,"mainVideoEntity"),"mainVideoEntity"),3)}J=l.C;if(!J)return l.return();m=Math.floor(r).toString();C={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:m}};return g.Q(l,y.Uf([x],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
C),0)})};
g.V.isOrchestrationLeader=function(){return this.C.isOrchestrationLeader()};
g.V.updateDownloadState=function(B,y){var a,r,k,x;return g.F(function(J){if(J.X==1)return g.Q(J,vU(),2);a=J.C;if(!a)return rg("PES is undefined"),J.return();r=g.$J(B);k=r.entityType;x=r.entityId;return g.Q(J,cW(x,k,a,y,!0),0)})};g.LT("offline",zsY);})(_yt_player);
